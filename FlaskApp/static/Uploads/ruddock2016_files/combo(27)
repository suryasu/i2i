YUI.add("hermes-template-empty-photo-page",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["global-nav-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<div class="fluid-centered" style="text-align: center;">\n	<h3>'+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.TIMEOUT_FAILURE"},data:i}))+"</h3>\n</div>\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["footer-full-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/empty-photo-page",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("empty-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},buildContainer:function(){return this.setContainerWithTemplate("empty-photo-page"),this}},{ATTRS:{spaceid:{value:792600606}}})},"@VERSION@",{requires:["flickr-view","hermes-template-empty-photo-page","photo-css","util-css","overflow-helper","url","fluid-css"],optional:["global-nav-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-page-lightbox",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(t!=null?t:{},t!=null?t["photo-well-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-lightbox",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" no-click"},3:function(e,t,n,r,i){return" is-hidden"},5:function(e,t,n,r,i){return" is-video"},7:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-url"]||(t!=null?t["prev-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-url",hash:{},data:i}):s))},9:function(e,t,n,r,i){return"#"},11:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-title"]||(t!=null?t["prev-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-title",hash:{},data:i}):s))},13:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-url"]||(t!=null?t["next-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-url",hash:{},data:i}):s))},15:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-title"]||(t!=null?t["next-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-title",hash:{},data:i}):s))},17:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return((s=n["if"].call(o,t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-toggle-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-actions-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["people-notes-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"},18:function(e,t,n,r,i){return'	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<a class="navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n'+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(o,t!=null?t["photo-well-media-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<a class="navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n'+((s=n.unless.call(o,t!=null?t["is-ad"]:t,{name:"unless",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"},3:function(e,t,n,r,i){return"	Please continue providing us with feedback so we can continue to improve Flickr.\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return"Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n"+((s=n["if"].call(t!=null?t:{},t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"<br>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'<form action="//'+f((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s===a?s.call(o,{name:"host",hash:{},data:i}):s))+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="'+f((s=(s=n["redirect-url"]||(t!=null?t["redirect-url"]:t))!=null?s:u,typeof s===a?s.call(o,{name:"redirect-url",hash:{},data:i}):s))+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{};return'	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:i}))+"</h2>\n"+((s=n["if"].call(o,t!=null?t.isSignedIn:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+"		</div>\n	</div>\n"},2:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:i}))+"<br />"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:i}))+"</p>\n\n"+((s=n.unless.call(o,t!=null?t.isMinor:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")},3:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return"					<p><button class='ui-button'><span>"+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:i}))+"</span></button></p>\n					<p>"+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:i}))+"</p>\n"},5:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:i}))+' <a href="//'+a((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"host",hash:{},data:i}):s))+'/signin/" data-track="photoWellSignInClick">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a></p>\n"},7:function(e,t,n,r,i){var s,o=t!=null?t:{};return"\n"+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")},8:function(e,t,n,r,i){var s;return'		<a class="ad-wrapper" href="'+e.escapeExpression(e.lambda((s=t!=null?t.ad:t)!=null?s.clickUrl:s,t))+'">\n'},10:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'			<div class="videoplayer main-photo" style="width:'+f((s=(s=n.width||(t!=null?t.width:t))!=null?s:u,typeof s===a?s.call(o,{name:"width",hash:{},data:i}):s))+"px; height:"+f((s=(s=n.height||(t!=null?t.height:t))!=null?s:u,typeof s===a?s.call(o,{name:"height",hash:{},data:i}):s))+'px;"></div>\n'},12:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression,l="function";return'\n			<div class="facade-of-protection-neue '+((s=n["if"].call(u,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				'+f((n.outlet||t&&t.outlet||a).call(u,t!=null?t["zoom-view"]:t,{name:"outlet",hash:{},data:i}))+'\n			</div>\n\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.src||(t!=null?t.src:t))!=null?o:a,typeof o===l?o.call(u,{name:"src",hash:{},data:i}):o))+'" class="low-res-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<noscript>\n				<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			</noscript>\n'},13:function(e,t,n,r,i){return"is-video"},15:function(e,t,n,r,i){var s;return'			<span class="ad-info">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{brand:(s=t!=null?t.ad:t)!=null?s.brand:s,intlName:"photo-page-scrappy.FIND_OUT_MORE_AD"},data:i}))+"</span>\n		</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.needsInterstitial:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e,t){var n=require("lib/flog")(t),r=500,i=500,s=100,o;o={photo:{render:function(){var t=this,n=this.get("photo"),r,i,o=new Date,u="";return t.preloadImage&&(t.preloadImage.onload=null),r=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n.getValue("owner")&&(n.getValue("title").trim()===""?u=this.intlMessage({intlName:"common.UNTITLED"}):u=n.getValue("title"),u+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),this.setContainerWithTemplate("photo-well-media",{width:r.width,height:r.height,src:i.url,highResSrc:r.url,imgAltText:u,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:n.getValue("isVideo"),isMinor:this.appContext.getViewer().isMinor,isAd:this.isAd}),this.fire("subviewViewEvent",r),YUI.Env.isServer?(this.serverWidth=r.width,this.serverHeight=r.height):n.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0;var n,i="photoPageShowedSize",u="\u00f8";try{n=/(?:_([a-z]))?\.jpg/.exec(r.url),n&&n[1]&&(u=n[1])}catch(a){}finally{i+=String(u).toUpperCase()}e.rapidTracker.beacon(this.name,i);var f=t.get("container").one(".low-res-photo"),l=t.get("container").one(".main-photo"),c=new Date-o,h;c<s?(l.removeClass("is-hidden").show(),f.hide()):(l.setStyles({position:"absolute",left:0,top:0,opacity:0}),l.removeClass("is-hidden"),h=function(){l.removeAttribute("style"),f.hide()},e.UA.ie?h():e.use("transition",function(e){l.transition({duration:.25,opacity:1},h)}))},t.preloadImage.src=r.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var t=this,n=this.get("photo"),r=this.getPhotoForDisplay({excludeSizes:[]});return this.player?(this.player.resize(r.width,r.height),this):(this.setContainerWithTemplate("photo-well-media",{width:r.width,height:r.height,src:r.url,needsInterstitial:n.getValue("needsInterstitial"),isVideo:n.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.fire("subviewViewEvent",r),YUI.Env.isServer?this:(this.player=new e.FlickrVideoPlayer({container:this.get("container").one(".videoplayer"),model:n,appContext:this.appContext}),t.player.init().then(function(){t}),this.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)}),this))}},ad:{render:function(){var e,t;return this.adJSON?e=this.adJSON:(e=this.appContext.adManager.getAdJSON(),this.adJSON=e),t=this.getAdSize(e),this.setContainerWithTemplate("photo-well-ad",{width:t.width,height:t.height,src:e.url,clickUrl:e.clickUrl,brand:e.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-zoom")},disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?o.ad.render.call(this):o[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var r=this,i=this.get("personPreferences"),s=this.get("photo"),o=s.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),i.setValue("safeSearch",o),i.registry.remoteUpdate(r.appContext.auth.user.nsid).then(function(e){var t=s.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){s.registry.getValue(e,"safetyLevel")<=i.getValue("safeSearch")&&s.registry.setValue(e,"needsInterstitial",!1)}),r.buildContainer()},function(e){n.error({err:e}),r.onError(r.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getInstance("dialog-alert",{content:t,attrs:{title:n.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:n.intlMessage({intlName:"common.OK"})},parent:n,offsetLeft:r});i.show()})},getPhotoForDisplay:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/
n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,t=this.getPixelRatio(),n;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(n=this.get("container").ancestor(),n&&(e=n.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:t})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:i,right:r,width:parseInt(this.appContext.getCookie("photoPW"),10)||r,height:parseInt(this.appContext.getCookie("photoPH"),10)||i}),e.height*=t,e.width*=t,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","moment","flickr-video-player","hermes-template-photo-well-ad","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("photo-head-meta-view",function(e){var t=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-head-meta-models",t._params.photoId),t.appContext.getModel("photo-models",t._params.photoId),t.appContext.getModel("photo-privacy-models",t._params.photoId)]).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1]),t.set("photo-privacy",e[2])})},buildHeadContainer:function(){var t=this.get("photo-meta"),n=this.get("photo"),r=this.get("photo-privacy"),i=e.url(),s=t.getFieldsForDisplay(),o="",u=this,a=[{id:"canonicalurl",rel:"canonical",href:i+n.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=json",title:n.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=xml",title:n.getValue("title")},{rel:"alternative",media:"only screen and (max-width: 640px)",href:"https://m.flickr.com"+encodeURI(n.getValue("url")+"/")}];s["al:ios:url"]||(s["al:ios:url"]="flickr://flickr.com"+n.getValue("url")),o+=this.templates("head-meta")({isName:!0,metaName:"description",metaValue:n.getValue("description")||n.getValue("title")})+"\n";var f="noarchive";return r.getValue("isPublic")||(f+=", noindex"),o+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:f}),o+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:f}),Object.keys(s).forEach(function(e){typeof s[e]=="object"&&e==="pinterest"?o+=u.templates("head-meta")({metaName:e,noPin:!0,metaValue:s[e].nopin,metaDescription:s[e].reason,isName:!0})+"\n":e==="og:description"?o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n":e==="title"?o+=u.templates("head-meta")({isName:!0,metaName:"title",metaValue:s[e]})+"\n":e==="keywords"?o+=u.templates("head-meta")({isName:!0,metaName:e,metaValue:s[e]})+"\n":e==="noindexfollow"?s[e]&&(s[e]>0||s[e]!=="")&&(o+=u.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noindex,follow"})+"\n",o+=u.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noindex,follow"})+"\n"):o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n"}),a.forEach(function(e){e.addedBy=u.name,o+=u.templates("head-link")(e)+"\n"}),this.set("headContainer",o),YUI.Env.isServer||this.updateHead(),this}});return e.mix(t.prototype,e.Seo),t},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link"],optional:["photo-head-meta-models","photo-route","url","seo"],langBundles:["meta","common","attribution","share-modal"]});
YUI.add("hermes-lang-meta",function(e,t){e.Intl.add("hermes/meta","en-US",{PHOTOSTREAM:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"photo on Flickr!",other:"${#} photos on Flickr!"}}],PHOTOSTREAM_NO_PHOTOS:["Explore ","${username}","'s photos on Flickr!"],ALBUMS_LIST:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"album on Flickr!",other:"${#} albums on Flickr!"}}],ALBUMS_LIST_NO_ALBUMS:["Explore ","${username}","'s albums on Flickr!"],FAVORITES:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"favorites on Flickr!",other:"${#} favorites on Flickr!"}}],FAVORITES_NO_PHOTOS:["Explore ","${username}","'s favorites on Flickr!"],META_DESCRIPTION_BY_USER_ON_FLICKR:["By ","${username}"," on Flickr"],PHOTOSTREAM_ATOM_TITLE:["Flickr: ","${username}","'s Photostream Atom feed"],FAVORITES_ATOM_TITLE:["Flickr: ","${username}","'s Favorites Atom feed"],GROUP_POOL_ATOM_TITLE:["Flickr: ","${groupName}","'s Photos Atom feed"],GROUP_DISCUSSIONS_ATOM_TITLE:["Flickr: ","${groupName}","'s Discussions Atom feed"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-lightbox-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;return this.backToURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.appContext.experiments.fullscreen.enableFullscreen(),t.realFullscreen=!0,t.isOwner=this.isOwner,this.enableZoom=this.appContext.flipper.isFlipped("enable-scrappy-zoom"),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},buildContainer:function(){var t=this.subviews["photo-well-view"].get("container");return t.addClass("scrappy-photo-page-enabled"),t.addClass("is-real-fullscreen"),this.enableZoom&&t.addClass("enable-zoom"),this.setContainerWithTemplate("photo-page-lightbox",{"photo-well-view":t}),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){return this},closeDialog:function(t){e.config.win.location.href=this.backToURL},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600552}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-lightbox","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","url","fluid-css"],optional:["photo-well-view","photo-head-meta-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-mobile-photo-page",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return"\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["global-nav-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["mobile-photo-well-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["mobile-photo-engagement-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["mobile-attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["photo-sidebar-actions-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-title-desc-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["mobile-sub-photo-stats-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-comments-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["photo-charm-exif-scrappy-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["mobile-sub-photo-license-privacy-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-tags-tag-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["footer-full-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-page",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-mobile-photo-well",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'	<a class="main-image-wrapper" href="'+l((o=(o=n.videoURL||(t!=null?t.videoURL:t))!=null?o:a,typeof o===f?o.call(u,{name:"videoURL",hash:{},data:i}):o))+'" '+((s=n["if"].call(u,t!=null?t.isServer:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n		<div class="play-wrapper">\n			<svg class="icon icon-play"><use xlink:href="#icon-play"></use></svg>\n		</div>\n\n		<img class="main-image" style="'+((s=n["if"].call(u,t!=null?t.isServer:t,{name:"if",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))!=null?s:"")+" max-width: 100%; max-height: "+l((o=(o=n.maxHeight||(t!=null?t.maxHeight:t))!=null?o:a,typeof o===f?o.call(u,{name:"maxHeight",hash:{},data:i}):o))+'px;" src="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" onload="registerFirstPhoto(this)" />\n	</a>\n'},2:function(e,t,n,r,i){var s;return' style="max-height: '+e.escapeExpression((s=(s=n.loadHeight||(t!=null?t.loadHeight:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"loadHeight",hash:{},data:i}):s))+'px;"'},4:function(e,t,n,r,i){return"width: 100%; "},6:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'	<div class="main-image-wrapper" '+((s=n["if"].call(u,t!=null?t.isServer:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n		<img class="main-image img" style="'+((s=n["if"].call(u,t!=null?t.isServer:t,{name:"if",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))!=null?s:"")+' max-width: 100%;" src="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" onload="registerFirstPhoto(this)"/>\n	</div>\n	<div class="main-image-wrapper-underlay"></div>\n	<script>\n	var windowWidth = window.innerWidth;\n	var aspect = '+l((o=(o=n.loadAspect||(t!=null?t.loadAspect:t))!=null?o:a,typeof o===f?o.call(u,{name:"loadAspect",hash:{},data:i}):o))+";\n\n	if (aspect) {\n		document.getElementsByClassName('main-image')[0].style.height = (windowWidth * aspect) + 'px';\n	}\n	</script>\n"},7:function(e,t,n,r,i){var s;return'style="max-height: '+e.escapeExpression((s=(s=n.loadHeight||(t!=null?t.loadHeight:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"loadHeight",hash:{},data:i}):s))+'px;"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return'\n<a class="loading hide-nav-link prev-photo photo-link" href="#">\n	<div class="arrow-overlay arrow-left">\n		<svg class="tiny icon icon-nav_left prev-photo-icon"><use xlink:href="#icon-nav_left"></use></svg>\n	</div>\n</a>\n\n'+((s=n["if"].call(t!=null?t:{},t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(6,i,0),data:i}))!=null?s:"")+'\n\n<a class="loading hide-nav-link next-photo photo-link" href="#">\n	<div class="arrow-overlay arrow-right">\n		<svg class="tiny icon icon-nav_right next-photo-icon"><use xlink:href="#icon-nav_right"></use></svg>\n	</div>\n</a>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("matrix-math",function(e){e.MatrixMath={iterate:function(t,n,r,i){var s=[],o=t.length,u=t[0].length,a,f;for(a=0;a<o;a++){s[a]=[];if(u)for(f=0;f<u;f++)e.Lang.isArray(n)?s[a][f]=r.call(i,t[a][f],n[a][f]):s[a][f]=r.call(i,t[a][f],n);else e.Lang.isArray(n)?s[a]=r.call(i,t[a],n[a]):s[a]=r.call(i,t[a],n)}return s},add:function(e,t){return this.iterate(e,t,function(e,t){return e+t},this)},subtract:function(e,t){return this.iterate(e,t,function(e,t){return e-t},this)},divide:function(e,t){return this.iterate(e,t,function(e,t){return e/t})},multiply:function(e,t){return this.iterate(e,t,function(e,t){return e*t})},realMultiply:function(e,t){var n=[],r=e.length,i=e[0].length,s,o,u;for(s=0;s<r;s++){n[s]=[];for(o=0;o<i;o++)for(u=0;u<i;u++)n[s][o]+=e[s][u]*t[s][o]}return n},equality:function(e,t){var n=!0;if(e.length!==t.length)return!1;try{this.iterate(e,t,function(e,t){if(e!==t)return n=!1,0})}catch(r){n=!1}return n}}},"@VERSION@",{requires:[],optional:[]});
YUI.add("mrpinchy",function(e){function r(e){var t=e.length,n=0,r=0,i=0;for(i=0;i<t;i++)r+=e[i].pageY,n+=e[i].pageX;return[n/t,r/t]}function i(i){function _(t){E++,T&&T.cancel(),Date.now()-x>180?(E=1,T=e.later(200,this,function(){L.fire("mrpinchy:singletap",t)})):E===2&&(D(),E=0,L.fire("mrpinchy:doubletap"),L.fire("mrpinchy:reset")),x=Date.now()}function D(){s&&(s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),V([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,1,1]],!0),s.setStyle("transform",M)),y=1,d=1}function H(e,t){var n=X(),r;t?r=e:r=y*e,n[0][0]=r,n[1][1]=r,V(n,!0),d=r}function B(e,t,r){var i,s,a,f,l,p,v,m=y*e;i=R(),s=[t[0]-i[0],t[1]-i[1]],a=[c,h],f=n.multiply(a,d),l=n.multiply(a,m),p=n.subtract(l,f),v=n.multiply(n.divide(s,l),p),U([v[0],-v[1]],!0),H(e);if(m>o&&!C||m<u&&!C)C={scale:e,translate:[X()[3][0],X()[3][1]]}}function j(e){if(e.touches&&e.touches.length>1){var t=Math.abs(e.touches[0].pageX-e.touches[1].pageX),n=Math.abs(e.touches[0].pageY-e.touches[1].pageY),r=Math.sqrt(t*t+n*n)/S;return r}return 1}function F(e){if(e.touches.length===2){m||L.fire("mrpinchy:startpinch"),m=1;var t=e.scale;t||(t=j(e)),B(t,r(e.touches))}}function I(e){var t,r,i,s,o,u={top:0,right:0,bottom:0,left:0},a={top:0,right:0,bottom:0,left:0};if(!v)return;var f=g[0]-v[0],l=g[1]-v[1];N&&(t=R(),i=[c,h],r=n.multiply(i,d),s=n.add(t,r),o=n.divide(r,2),o=n.add(o,t),t[1]<N[0][1]&&(a.top=1),t[0]<N[0][0]&&(a.left=1),s[0]>N[1][0]&&(a.right=1),s[1]>N[1][1]&&(a.bottom=1));var m=X();if(a.left||a.right||!N){var y=parseInt(m[3][0],10)+Math.round(f);y&&(m[3][0]=y)}if(a.bottom||a.top||!N)m[3][1]=parseInt(m[3][1],10)+Math.round(l);V(m),v=g,k=null,t[1]>N[0][1]&&a.bottom&&(u.bottom=1),s[1]<N[1][1]&&a.top&&(u.top=1),t[0]>N[0][0]&&a.right&&(u.right=1),s[0]<N[1][0]&&a.left&&(u.left=1),u.bottom&&u.right?k=n.subtract(N[0],p):u.bottom&&u.left?k=n.subtract([N[1][0],N[0][1]],[Math.round((p[0]+c)*d),p[1]]):u.top&&u.right?k=[N[0][0]-p[0],N[1][1]-(p[1]+r[1])]:u.top&&u.left?k=[N[1][0]-(p[0]+r[0]),N[1][1]-(p[1]+r[1])]:u.right?k=[N[0][0]-p[0],parseInt(m[3][1],10)+Math.round(l)]:u.left?k=[Math.round(N[1][0]-p[0]-r[0]),parseInt(m[3][1],10)+Math.round(l)]:u.bottom?k=[parseInt(m[3][0],10)+Math.round(f),Math.round(N[0][1]-p[1])]:u.top&&(k=[parseInt(m[3][0],10)+Math.round(f),N[1][1]-(p[1]+r[1])])}function q(e){w||(e.preventDefault(),P[e.type](e))}function R(){return s.getXY()}function U(e,t){var n=X();t?(n[3][0]-=e[0],n[3][1]+=e[1]):(n[3][0]=e[0],n[3][1]=e[1]),V(n)}function z(){var e=X(),t=[];t.push([e[0][0],e[0][1]]),t.push([e[1][0],e[1][1]]),t.push([e[3][0],e[3][1]]),s&&s.setStyle("transform","matrix( "+t.join(",")+")")}function W(){var e=X();V(e)}function X(){var e,n=[],r=[],i;if(a)return a;i=s.getStyle("transform");if(!i.match(t))return V([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,1,1]],!0),a;e=i.match(t)[1],r=e.replace(/\s/g,"").split(",");var o=0,u;for(var f=0;f<4;f++){u=[];for(var l=0;l<4;l++)u.push(r[o++]);n.push(u)}return a=n,n}function V(e,t){if(!e)return;if(e.length!==4)return;a=e,t&&$()}function $(){var e=a;e&&s&&s.setStyle("transform","matrix3d("+e.join(",")+")")}function J(){return q}function K(){s=null,w=!0}var s=i.node,o=i.maxScale||10,u=i.minScale||.5,a,f,l=s.one(".img"),c=l.get("offsetWidth"),h=l.get("offsetHeight"),p=l.getXY(),d=1,v=[0,0],m=0,g=[0,0],y=1,b=0,w=!1,E=0,S,x=0,T,N,C,k,L=new e.EventTarget,A,O="transform 0.25s ease-out",M=s.getStyle("transform");i.boundingBox?N=i.boundingBox:N=[[0,0],[window.innerWidth,window.innerHeight]],s&&s.setStyles({"-webkit-transform-origin":"0 0","-moz-transform-origin":"0 0","-o-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0"}),A=s,s&&s.on("webkitTransitionEnd",function(){A.setStyles({"-webkit-transition":"","-moz-transition":"","-o-transition":"","-ms-transition":"",transition:""})});var P={touchstart:function(e){W(),g=r(e.touches),v=g,f=g,e.touches.length===1?b=Date.now():b=0;if(e.touches.length===2){var t=Math.abs(e.touches[0].pageX-e.touches[1].pageX),n=Math.abs(e.touches[0].pageY-e.touches[1].pageY);S=Math.sqrt(t*t+n*n)}},touchmove:function(e){g=r(e.touches),!m&&e.touches.length===1?d!==1&&I(e):e.touches.length===2&&(b=0,F(e)),$()},touchend:function(e){e.touches.length<1&&d!==1?(y=d,b?(Date.now()-b<100&&(_(e),b=0),b=0,k&&(s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),U(k),$(),k=null),L.fire("mrpinchy:endmove")):y>o?(H(o,!0),U(C.translate),d=o,y=o,s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),$(),C=null):y<u&&(H(u,!0),U([0,0]),d=u,y=u,s.setStyles({"-webkit-transition":"-webkit-"+O,"-moz-transition":"-moz-"+O,"-o-transition":"-o-"+O,"-ms-transition":"-ms-"+O,transition:O}),$(),L.fire("mrpinchy:reset",y),D(),C=null),L.fire("mrpinchy:endpinch",y),m=0,z()):d===1&&L.fire("mrpinchy:endpinch",1)}};return L.getTouchHandler=J,L.destroy=K,L.updateBoundingBox=function(e){N=e},L.updateImageSize=function(){c=l.get("offsetWidth"),h=l.get("offsetHeight")},L.resetTransform=function(){D()},L}var t=/matrix3d\(([^\)]+)\)/,n=e.MatrixMath;e.MrPinchy={init:function(e){return new i(e)}}},"@VERSION@",{requires:["matrix-math"],optional:[]});
YUI.add("mobile-photo-well-view",function(e){var t=3,n="https://m.flickr.com/photos/{nsid}/{photoid}/play/",r=500,i=500;e.namespace("Views")[this.name]=e.Base.create("mobile-photo-well-view",e.FlickrView,[],{langBundles:["common"],initializer:function(t){this.photoId=t.photoId,this.context=e.clone(t.context,!0);var n=this.appContext.getUA().os;this.nsid=t.nsid,this.disablePinchZooming=n==="windows",this.isAndroid=n==="android";if(this.context&&this.context.params&&this.context.params.isSharedEntity){var r=this.context.params;this.appContext.setGPCredentials({gp_code:r.gpCode,gp_owner:r.gpOwner,share_code:r.gpCode})}else this.appContext.setGPCredentials(null);return this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.set("photoModel",e)})),e.Promise.all(n)},buildContainer:function(){var s,o,u=this.get("photoModel").getValue("isVideo"),a,f,l,c;if(YUI.Env.isServer)s=r,o=i,a=s/8,f=o/8;else{s=parseInt(e.StorageHelper.getItem("mobile-photo-well-width"),10),o=parseInt(e.StorageHelper.getItem("mobile-photo-well-height"),10);var h=this.getUsableAreaSize(),p=h.actualW,d=h.adjustedH;if(!s||isNaN(s)||s<50)s=p;if(!o||isNaN(o)||o<50)o=d;a=s,f=o}var v=this.get("photoModel").getSizeToFit({width:a,height:f},{cropToFit:!0});return this.set("bestImageSize",v),l=Math.max(v.height/t,o),c=v.height/v.width,this.setContainerWithTemplate("mobile-photo-well",{maxHeight:l,isServer:YUI.Env.isServer,loadAspect:c,loadHeight:c*s,url:v.url,videoURL:n.replace("{nsid}",this.nsid).replace("{photoid}",this.photoId),isVideo:u}),this},activate:function(){var e=this.get("container"),t=e.one(".main-image"),n=e.one(".main-image-wrapper"),r=this.get("photoModel"),i=this.get("photoModel").getValue("isVideo"),s=this;e.all(".photo-link.loading").removeClass("loading"),t.setStyle("width",null),n.setStyle("height",null),this.findBestPhoto(r,t),this.appContext.getViewCounter().queue(this.get("photoModel").getValue("id"),this.appContext.getReferrer()),this.loadAdjacentPhotos();var o=parseInt(n.getComputedStyle("height"),10);return this.get("container").setStyle("height",o+"px"),n.setStyle("position","absolute"),!i&&!this.disablePinchZooming&&this.addPinchy(),window.orientation&&(window.onorientationchange=function(){var e=window.innerWidth,t=window.innerHeight,n=e>t,r=[[0,0],[n?t:e,n?e:t]];s.transform.updateBoundingBox(r),s.transform.updateImageSize()}),this.context&&this.context.modelName&&this.context.params&&this.appContext.getModel(this.context.modelName,this.context.params).then(function(e){if(e)return s.set("contextModel",e),e.getValue("photoContextList").getContext({photoId:s.photoId}).then(function(){var t=-1,n=e.getValue("photoContextList").getList();n.some(function(e,n){return e.id===s.photoId&&(t=n),t>0});if(t>-1){var r,i,o,u,a="/in/"+e.getValue("urlSuffix");t>0&&(r=n[t-1],r&&(o=r.getValue("url")+a)),t<n.length-1&&(i=n[t+1],i&&(u=i.getValue("url")+a)),o&&s.get("container").one(".prev-photo").setAttribute("href",o).removeClass("hide-nav-link"),u&&s.get("container").one(".next-photo").setAttribute("href",u).removeClass("hide-nav-link")}})}),this},addPinchy:function(){var n=window.innerWidth,r=window.innerHeight,i=n>r,s=this.get("container").one(".main-image-wrapper"),o=this.get("container").one(".main-image-wrapper-underlay"),u=[[0,0],[i?r:n,i?n:r]],a=this,f;this.transform=e.MrPinchy.init({node:s,maxScale:i?2:t,minScale:1,boundingBox:u}),f=this.transform.getTouchHandler(),this.largeLoaded=!1,s.on("touchstart",function(t){f(t),a.largeLoaded||(a.largeLoaded=!0,a.findBestPhoto(a.get("photoModel"),s.one(".img"),!0,!0)),a.addZoomTimeout=setTimeout(function(){a.get("container").addClass("zoomed"),s.addClass("zoomed"),e.one("html").setStyle("position","fixed"),o.setStyle("display","block"),setTimeout(function(){o.addClass("show-overlay")},10)},200)}),s.on("touchmove",function(e){f(e)}),s.on("touchend",function(e){f(e)}),s.on("touchcancel",function(e){a.transform.resetTransform(),a.transform.fire("mrpinchy:reset")}),this.transform.on("mrpinchy:reset",function(){clearTimeout(a.addZoomTimeout),a.get("container").removeClass("zoomed"),s.removeClass("zoomed"),e.one("html").setStyle("position",null),o.removeClass("show-overlay"),setTimeout(function(){o.setStyle("display","none")},800)}),this.transform.on("mrpinchy:endpinch",function(t){t===1&&(clearTimeout(a.addZoomTimeout),a.get("container").removeClass("zoomed"),s.removeClass("zoomed"),e.one("html").setStyle("position",null),o.removeClass("show-overlay"),setTimeout(function(){o.setStyle("display","none")},800))})},getUsableAreaSize:function(){var e=window.innerWidth,t=window.innerHeight,n=t-50-50;return this.get("container").ancestor(".show-upsell-banner")&&(n-=50),{actualW:e,actualH:t,adjustedH:n}},findBestPhoto:function(n,r,i,s){var o=this.getUsableAreaSize(),u=o.actualW,a=o.adjustedH,f=n.getSizeToFit({width:i?u*t:u,height:i?a*t:a},{cropToFit:!0});a=Math.min(u/f.width*f.height,o.adjustedH);if(r)r.getAttribute("src")!==f.url&&r.setAttribute("src",f.url),this.set("bestImageSize",f),r.setStyle("height",a),this.get("container").setStyle("height",a),YUI.Env.isServer||(e.StorageHelper.setItem("mobile-photo-well-width",u),e.StorageHelper.setItem("mobile-photo-well-height",o.adjustedH));else{var l=new Image;l.src=f.url}},loadAdjacentPhotos:function(){var e=this.get("prevPhoto"),t=this.get("nextPhoto");t&&this.findBestPhoto(t),e&&this.findBestPhoto(e)}},{ATTRS:{}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-mobile-photo-well","viewport-data","storage-helper","mrpinchy"],langBundles:["common"]});
YUI.add("hermes-template-mobile-photo-engagement",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression;return'			<span class="fave-count-label" style="margin-left: '+f((o=(o=n.faveSvgMargin||(t!=null?t.faveSvgMargin:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"faveSvgMargin",hash:{},data:i}):o))+'px">\n'+((s=n["if"].call(u,(s=t!=null?t.engagement:t)!=null?s.isFaved:s,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:"")+"				"+f((n.friendlyNumber||t&&t.friendlyNumber||a).call(u,(s=t!=null?t.engagement:t)!=null?s.faveCount:s,{name:"friendlyNumber",hash:{},data:i}))+"\n			</span>\n"},2:function(e,t,n,r,i){return'					<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n'},4:function(e,t,n,r,i){return'					<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n'},6:function(e,t,n,r,i){var s;return'			<span class="fave-count-label" style="margin-left: '+e.escapeExpression((s=(s=n.faveSvgMargin||(t!=null?t.faveSvgMargin:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"faveSvgMargin",hash:{},data:i}):s))+'px">\n				<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n				0\n			</span>\n'},8:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression;return'			<span class="comment-count-label" style="margin-left: '+f((o=(o=n.commentSvgMargin||(t!=null?t.commentSvgMargin:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"commentSvgMargin",hash:{},data:i}):o))+'px">\n				<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n				'+f((n.friendlyNumber||t&&t.friendlyNumber||a).call(u,(s=t!=null?t.engagement:t)!=null?s.commentCount:s,{name:"friendlyNumber",hash:{},data:i}))+"\n			</span>\n"},10:function(e,t,n,r,i){var s;return'			<span class="comment-count-label" style="margin-left: '+e.escapeExpression((s=(s=n.commentSvgMargin||(t!=null?t.commentSvgMargin:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"commentSvgMargin",hash:{},data:i}):s))+'px">\n				<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n			0</span>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'<div class="actions-container">\n	<div class="fave-count">\n'+((s=n["if"].call(o,(s=t!=null?t.engagement:t)!=null?s.faveCount:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(6,i,0),data:i}))!=null?s:"")+'	</div>\n\n	<div class="comment-count">\n'+((s=n["if"].call(o,(s=t!=null?t.engagement:t)!=null?s.commentCount:s,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:"")+'	</div>\n\n	<div class="share-container">\n		<span class="share-container-icon">\n			<svg class="icon icon-share_hollow"><use xlink:href="#icon-share_hollow"></use></svg>\n		</span>\n	</div>\n\n	<div class="vr vr-container">\n		<a href="#" title="'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.IMMERSIFY"},data:i}))+'">\n			<svg class="icon icon-vr_hollow"><use xlink:href="#icon-vr_hollow"></use></svg>\n		</a>\n	</div>\n	'+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["vr-overlay-view"]:t,{name:"outlet",hash:{},data:i}))+"\n</div>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-engagement",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-mobile-share-modal",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'<div class="share">\n	<p>'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"share-modal.SHARE"},data:i}))+'</p>\n\n	<form>\n		<input type="text" value="'+a((s=(s=n.shortUrl||(t!=null?t.shortUrl:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"shortUrl",hash:{},data:i}):s))+'" readonly>\n	</form>\n</div>'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-share-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-stats-photo",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression,c=e.lambda;return'\n	<div class="photo-stats-basics">\n		<div class="photo-stats-basics-left">\n			<a href="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" class="photo-thumbnail" style="background-image: url('+l((o=(o=n.photoUrl||(t!=null?t.photoUrl:t))!=null?o:a,typeof o===f?o.call(u,{name:"photoUrl",hash:{},data:i}):o))+');"></a>\n			<div class="photo-info">\n				<a href="'+l((o=(o=n.url||(t!=null?t.url:t))!=null?o:a,typeof o===f?o.call(u,{name:"url",hash:{},data:i}):o))+'" class="photo-title truncate">'+l((o=(o=n.title||(t!=null?t.title:t))!=null?o:a,typeof o===f?o.call(u,{name:"title",hash:{},data:i}):o))+'</a>\n				<div class="photo-posted-date">\n'+((s=(n.friendlyDateScrappySubphoto||t&&t.friendlyDateScrappySubphoto||a).call(u,t!=null?t.datePosted:t,false,false,{name:"friendlyDateScrappySubphoto",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))!=null?s:"")+'				</div>\n			</div>\n		</div>\n		<div class="photo-stats-basics-right">\n			<div class="view-count"><i></i> '+l(c((s=t!=null?t.basicStats:t)!=null?s.viewCount:s,t))+'</div>\n			<div class="fave-count"><i></i> '+l(c((s=t!=null?t.basicStats:t)!=null?s.faveCount:s,t))+'</div>\n			<div class="comment-count"><i></i> '+l(c((s=t!=null?t.basicStats:t)!=null?s.commentCount:s,t))+'</div>\n		</div>\n	</div>\n\n	<div class="photo-stats-nav">\n		<div class="nav-links">\n			<div class="photo-stats-nav-link selected" data-link="views">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"stats.RECENT_VIEWS"},data:i}))+'</div>\n			<div class="photo-stats-nav-link" data-link="sources">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"stats.SOURCES"},data:i}))+'</div>\n		</div>\n		<div class="photo-stats-nav-extras">\n			<div class="date-picker">'+l((o=(o=n.prettyDateString||(t!=null?t.prettyDateString:t))!=null?o:a,typeof o===f?o.call(u,{name:"prettyDateString",hash:{},data:i}):o))+' <span></span></div>\n		</div>\n	</div>\n\n	<div class="photo-stats-sections" data-showing="views">\n\n		<div class="photo-stats-section" data-section="views">\n			<div class="daily-views-graph">\n			</div>\n		</div>\n\n		<div class="photo-stats-section" data-section="sources">\n\n			<div class="source-breakdown-left'+((s=n.unless.call(u,t!=null?t.hasReferrers:t,{name:"unless",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				<div class="no-sources">\n					'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"stats.NO_SOURCES_TODAY"},data:i}))+'\n				</div>\n\n				<div class="sources-pie-chart pie-chart"></div>\n			</div>\n\n			<div class="source-breakdown-right'+((s=n.unless.call(u,t!=null?t.hasReferrers:t,{name:"unless",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				<div class="sources-breakdown">\n					<div class="sources-breakdown-header">\n						<div>'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"stats.SOURCES"},data:i}))+"</div>\n						<div>"+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"stats.VISITS"},data:i}))+'</div>\n						<div>%</div>\n					</div>\n					<div class="sources-breakdown-list"></div>\n				</div>\n			</div>\n\n		</div>\n\n	</div>\n\n'},2:function(e,t,n,r,i){return"						"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlDate:t!=null?t.intlDate:t,intlName:t!=null?t.intlName:t},data:i}))+"\n"},4:function(e,t,n,r,i){return" no-results"},6:function(e,t,n,r,i){return'\n	<div class="no-stats-available">\n		'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"stats.NO_RECENT_PHOTO_STATS_AVAILABLE"},data:i}))+"\n	</div>\n\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.actuallyHasSomeStats:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(6,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/stats-photo",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("timezone-helper",function(e){"use strict";e.TimezoneHelper=function(t,n,r){r?(this.tz=r,this.dst=!1):(this.tz=t.getViewer().prefs.timezonePref.offset,this.dst=t.getViewer().prefs.timezonePref.dst),this.momentObject=e.moment(n,"X"),this.momentObject.utcOffset(this.tz),this.dst&&this.momentObject.isDST()&&this.momentObject.add(1,"hour")},e.TimezoneHelper.prototype.toFormat=function(e){return this.momentObject.format(e)}},"@VERSION@",{requires:["moment"]});
YUI.add("stats-helper",function(e){"use strict";var t;YUI.Env.isServer?t=require("querystring").stringify:t=function(e){var t=[],n,r,i;for(n in e)if(e.hasOwnProperty(n))if(Array.isArray(e[n]))for(r=0,i=e[n].length;r<i;r++)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n][r]));else t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},e.StatsHelper=function(){},e.StatsHelper.prototype.moveToFrontOfArray=function(e,t){var n=-1;return e.forEach(function(e,r){e===t&&(n=r)}),n>-1&&e.unshift(e.splice(n,1)[0]),e},e.StatsHelper.prototype.moveToEndOfArray=function(e,t){var n=-1;return e.forEach(function(e,r){e===t&&(n=r)}),n>-1&&(e.push(e[n]),e.splice(n,1)),e},e.StatsHelper.prototype.whichChild=function(e){var t=0;while((e=e.previousElementSibling)!==null)++t;return t},e.StatsHelper.prototype.getRoundedRectanglePath=function(e,t,n,r,i,s,o){var u=e[0],a=e[1],f=t[0],l=t[1],c;return c="M"+(u+n)+","+a,c+="h"+(f-2*n),i?c+="a"+n+","+n+" 0 0 1 "+n+","+n:(c+="h"+n,c+="v"+n),c+="v"+(l-2*n),o?c+="a"+n+","+n+" 0 0 1 "+ -n+","+n:(c+="v"+n,c+="h"+ -n),c+="h"+(2*n-f),s?c+="a"+n+","+n+" 0 0 1 "+ -n+","+ -n:(c+="h"+ -n,c+="v"+ -n),c+="v"+(2*n-l),r?c+="a"+n+","+n+" 0 0 1 "+n+","+ -n:(c+="v"+ -n,c+="h"+n),c+="z",c},e.StatsHelper.prototype.getIdFromParams=function(e){var n=t(e);return n===""&&(n=1),n},e.StatsHelper.prototype.convertStorageTotalToRealNumber=function(e){var t=e;return e===-1&&(t=-1),t},e.StatsHelper.prototype.convertStorageAmountToRealNumber=function(e){var t,n,r,i=100;return e=parseInt(e,10)||1,t=Math.ceil(Math.log(e)/Math.LN10),n=Math.floor(t/3),r=e/Math.pow(10,n*3),r=Math.floor(r*i)/i,r},e.StatsHelper.prototype.convertNaturalLanguageDateToRealDateTimestamp=function(t,n){var r="",i;i=e.moment();switch(n){case"today":r=i;break;case"yesterday":r=i.subtract(1,"days");break;case"thisweek":case"week":r=i.startOf("week");break;case"lastweek":r=i.subtract(1,"weeks").startOf("week");break;case"twoweeksago":case"theweekbeforethat":r=i.subtract(2,"weeks").startOf("week");break;case"threeweeksago":case"theweekbeforetheweekbeforethat":r=i.subtract(3,"weeks").startOf("week")}return r!==""&&(r=(new e.TimezoneHelper(t,r.format("X"),"00:00")).toFormat("YYYY-MM-DD")),r}},"@VERSION@",{affinity:"",requires:["flickr-promise","event-custom","moment","timezone-helper"],optional:[]});
YUI.add("flickr-stats-photo-daily-views-fetcher",function(e,t){"use strict";function n(e){var t={id:e.id,photo_id:e.photoId};return t}function r(t,n){var r=t.apiResponse.stats,i=r.graphdata,s=t.modelRegistry,o,u={},a={},f=[],l,c,h,p,d;return d={views:0,favs:0,comments:0},o={id:n.id},i&&(u=i,f=Object.keys(i),f.forEach(function(e,t){!u[e].burp&&!u[e].nodot?(c?(c>e&&(c=e),p<e&&(p=e)):(c=e,p=e),u[e].views||(u[e].views=0),u[e].comments||(u[e].comments=0),u[e].favs||(u[e].favs=0),u[e].views=parseInt(u[e].views,10),u[e].favs=parseInt(u[e].favs,10),u[e].comments=parseInt(u[e].comments,10),d.views+=u[e].views,d.favs+=u[e].favs,d.comments+=u[e].comments):delete u[e]})),o.days=u,o.oldestDate=c,o.newestDate=p,o.totals=d,s.exists(o.id)?(a=s.getValue("days"),o.days=e.merge(o.days,a),l=s.getValue("oldestDate"),c>l&&(o.oldestDate=l),h=s.getValue("newestDate"),p>h&&(o.newestDate=h),o.totals+=e.merge(o.totals,s.getValue("totals")),s.setValues(o.id,o)):s.add(o),o}function i(n,r){var i=this;return(new e.FlickrPromise({apiResponse:r.callAPI("flickr.stats.photo.getGraphData",this._processParams(n)),modelRegistry:r.getModelRegistry("stats-photo-daily-views-models")})).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-stats-photo-daily-views"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["stats-photo-daily-views-models"]});
