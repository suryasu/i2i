YUI.add("photo-list-photo-interaction-view",function(e,t){var n=require("lib/helpers/type-validator"),r=require("lib/flog")(t);"use strict";var i=300,s={css:{faveClickArea:".fave-area",commentClickArea:".comment-area",removeFaveTool:"remove-fave",removePoolTool:"remove-group-pool",scotchTool:"scotch-photo",licenseButton:".photoListLicenseButton"}},o=25,u=20,a=10,f=75;e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=this.appContext.getViewer();return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),(!t.signedIn||e.nsid!==t.nsid)&&this.set("viewingSelf",!1),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),e.photoPageUrl&&this.set("photoPageUrl",e.photoPageUrl),this.params=e,this},loadState:function(){var t=[],n=this.get("listModelParams");return t.push(this.appContext.getModel(this.get("engagementModelName"),this.get("id"))),n&&t.push(this.appContext.getModel(n.registryName,n.modelIdOrAttributes)),e.Promise.all(t).then(function(e){var t=e[0],n=e[1];this.set("engagement",t),this.extraFunctionality={},this.params.removeOwnFaves?this.get("model").getValue("isOwner")&&!this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removeFaveTool):this.params.removePoolPhoto?this.get("model").getValue("isOwner")?this.extraFunctionality.removeToolClass=s.css.removePoolTool:n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&(this.extraFunctionality.removeToolClass=s.css.removePoolTool):this.params.scotch&&(this.extraFunctionality.removeToolClass=s.css.scotchTool),this.params.excludePeople&&(this.extraFunctionality.moreMenuItems="exclude-people"),this.params.bigScotch&&(this.extraFunctionality.bigScotchTitle=this.godMessage({intlName:"explore.DO_BIG_SCOTCH"}))}.bind(this))},buildContainer:function(e){var t=this.get("engagement"),n=t.getValue("faveCount"),r=t.getValue("isFaved"),i=t.getValue("canFave"),s=t.getValue("commentCount"),l=55,c=!0;return n>=100?l+=o:n>=10?l+=u:n>0&&(l+=a),s>=100?l+=o:s>=10?l+=u:s>0&&(l+=a),this.get("layoutWidth")-l<f&&(c=!1),e=e||{},n=n<100?n:"99+",s=s<100?s:"99+",e.photo=this.get("model").toJSON(),e.photoPageUrl=this.get("photoPageUrl"),e.faveCount=n,e.isFaved=r,e.canFave=i,e.commentCount=s,e.displayTitleAndAttribution=c,e.hasExtraFunctionality=Object.keys(this.extraFunctionality).length>0,e.removeToolClass=this.extraFunctionality.removeToolClass,e.moreMenuItems=this.extraFunctionality.moreMenuItems,e.bigScotchTitle=this.extraFunctionality.bigScotchTitle,e.curatorTools=this.getCuratorTools(),this.setContainerWithTemplate("photo-list-photo-interaction",e),this},activate:function(){var e=this.appContext.getViewer(),t=this.get("engagement"),n=this.get("container");return this.get("engagement").getValue("canFave")&&(this.registerEventHandler(t.on("valuesChanged",this.faveStarChanged.bind(this))),this.registerEventHandler(n.delegate("click",this.faveStarClicked.bind(this),s.css.faveClickArea))),this.signedOutTest&&!e|!e.signedIn&&this.registerEventHandler(n.delegate("click",this.commentClicked.bind(this),s.css.commentClickArea)),this.appContext.flipper.isFlipped("display-marketplace-licensable")&&n.one(s.css.licenseButton)&&(this.registerEventHandler(n.one(s.css.licenseButton).on("click",this.licenseButtonClick,this)),this.registerEventHandler(n.one(s.css.licenseButton).on("mouseenter",this.licenseButtonHover,this)),this.registerEventHandler(n.one(s.css.licenseButton).on("mouseleave",this.licenseButtonHover,this))),this},licenseButtonHover:function(t){t.halt();var n=t.type,r=this;if(n==="mouseenter"){if(e.StorageHelper.getItem("seenThirdParty"))return;this.tooltip&&this.tooltip.close(),clearTimeout(this.tooltipHoverTimer),this.isHovering=!0,this.tooltipHoverTimer=setTimeout(function(){r.isHovering&&(r.tooltip=new e.Views.FluidDroparound({appContext:r.appContext,showDropArrow:!0,dismissOnOverlayClick:!1,dismissOnActionClick:!1,observePageResize:!0,anchorElement:t.target,positionFixed:!0,closeOnScroll:!0,hideModalOverlay:!0,invisibleOverlay:!0,autoSizeToContent:!0,useAnchorOffsetSize:!0,horizCenterToAnchor:!0,preferTop:!0,classList:"photo-license-pop-up",textMessage:r.intlMessage({intlName:"common.CLICK_BUTTON_THIRD_PARTY"})}),r.tooltip.show())},i)}else this.isHovering=!1,this.tooltip&&this.tooltip.close()},licenseButtonClick:function(t){var n={owner_id:t.target.getData("ownerid"),photo_id:t.target.getData("photoid")};this.appContext.callAPI("flickr.licensing.marketplace.addClick",n).then(function(){e.StorageHelper.setItem("seenThirdParty",1)},function(e){r.error("flickr.licensing.marketplace.addClick failed",{err:e,photoId:n.photo_id})})},commentClicked:function(t){var n=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"}),i,s=this.get("engagement"),o,u=this;t.halt(),e.rapidTracker.beacon(u.name,"commentIconClick"),o=e.url(e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("ownerNsid")})),i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-comment",signUpTitle:n,signUpMessage:r,beaconPrefix:"comment"}),i.on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("comment",{postLoginUrl:o})}),i.on("signInClick",function(t){e.SigninHelper._redirectToSignin("comment",{postLoginUrl:o})}),i.show()},getCuratorTools:function(){if(!this.appContext.flipper.isFlipped("enable-curator-tools")||!this.appContext.getViewer().isInsecureGod)return null;var e=this.get("model"),t=e&&e.getValue("curation"),n=[];return t?(["is3MP","ownerCountryApproved","ownerFollowedByCurators","ownerAdded","ownerPassedOver"].forEach(function(e){t.getValue(e)&&n.push({name:e})}),n):null},showSignUpAndFaveModal:function(t,n){var r=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),i=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}),s;s=new 
e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:r,signUpMessage:i,beaconPrefix:"fave"}),s.on("signUpClick",function(r){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:n})}),s.on("signInClick",function(r){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:n})}),s.show()},faveStarClicked:function(t){var n=this.appContext.getViewer(),r=this.get("engagement"),i=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),s=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),o=this.intlMessage({intlName:"common.CANCEL"}),u,a,f,l=this;t.halt(),e.rapidTracker.beacon(this.name,"faveButtonClick");if(n&&n.signedIn)this.get("isFaving")||(this.set("isFaving",!0),r.toggleFave(),r.remoteUpdate().then(function(){this.appContext.getModelRegistry("favorite-models").then(function(e){e.proxy(n.nsid).getValue("photoPageList").remove(l.get("model"))}),this.set("isFaving",!1)}.bind(this),function(e){e.code!==3&&r.toggleFave(),this.set("isFaving",!1)}.bind(this)));else{a=r.getValue("id"),f=e.url(e.URLHelper.getPhotoPage({photoId:a,pathAlias:r.getValue("ownerNsid")}));if(this.signedOutTest)return this.showSignUpAndFaveModal(a,f);u=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:i,actionButtonLabel:s,cancelButtonLabel:o}),u.on("actionClick",function(){e.rapidTracker.beacon(l.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:a},{postLoginUrl:f})}),u.on("cancelClick",function(t){e.rapidTracker.beacon(l.name,"faveModalCancelClick")}),u.show()}t.halt()},faveStarChanged:function(e){(e.faveCount!==undefined||e.isFaved!==undefined||e.canFave!==undefined)&&this.buildContainer()},destructor:function(){}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return n.photoId(e)}},model:{writeOnce:"initOnly"},listModelParams:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"},engagement:{value:null},viewingSelf:{value:!0},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,n){return e.AttributeHelpers.validateString(t)}},layoutWidth:{validator:function(t,n){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||undefined},defaultFn:function(e){return 0}},isFaving:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo-interaction","photo-list-photo-interaction-css","attribute-helpers","fluid-modal-view","fluid-droparound-view","url","flickrui-css"],optionalRequires:["fluid"],langBundles:["fave-view","common","photo-page-scrappy"]});
YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["You must be signed in to fave. Please sign in now."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"],SIGN_IN_BEFORE_FAVE_TITLE:["You found a photo to fave!"],SIGN_IN_BEFORE_FAVE_MESSAGE:["That's great. Just sign in to fave it."],SIGN_IN_AND_FAVE:["Sign in and fave"],JOIN_FLICKR_AND_FAVE:["Join Flickr to add this photo to your favorites."]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-follow",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:""},2:function(e,t,n,r,i){return""},4:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},5:function(e,t,n,r,i){return"			<button class='follow alt'>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNBLOCK"},data:i}))+"</button>\n"},7:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:""},8:function(e,t,n,r,i){return'				<button class="follow is-following mini"><span class="drop-icon">\u25be</span></button>\n'},10:function(e,t,n,r,i){return'				<button class="follow mini"></button>\n'},12:function(e,t,n,r,i){var s,o=t!=null?t:{};return((s=n["if"].call(o,t!=null?t.isFluid:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(23,i,0),data:i}))!=null?s:"")+"	"+((s=n["if"].call(o,t!=null?t.curationEnrollmentStatus:t,{name:"if",hash:{},fn:e.program(30,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},13:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:""},14:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.program(17,i,0),data:i}))!=null?s:""},15:function(e,t,n,r,i){return"				<button class='follow alt'>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNBLOCK"},data:i}))+"</button>\n"},17:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.program(21,i,0),data:i}))!=null?s:""},18:function(e,t,n,r,i){var s,o=t!=null?t:{};return'					<button class="follow is-following '+((s=n["if"].call(o,t!=null?t.isOnDark:t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:t!=null?t.followingIntlKey:t},data:i}))+'<span class="drop-icon">\u25be</span></button>\n'},19:function(e,t,n,r,i){return"white"},21:function(e,t,n,r,i){var s,o=t!=null?t:{};return'					<button class="follow '+((s=n["if"].call(o,t!=null?t.isOnDark:t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:t!=null?t.followIntlKey:t},data:i}))+"</button>\n"},23:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(24,i,0),data:i}))!=null?s:""},24:function(e,t,n,r,i){var s;return'			<span class="relationship">\n'+((s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(25,i,0),data:i}))!=null?s:"")+"			</span>\n"},25:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(26,i,0),inverse:e.program(28,i,0),data:i}))!=null?s:""},26:function(e,t,n,r,i){return"						<button class='unfluid follow is-following ui-button ui-button-icon ui-button-transparent ui-button-dropdown'><span>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.FOLLOWING"},data:i}))+"</span></button>\n"},28:function(e,t,n,r,i){return"						<button class='unfluid follow ui-button ui-button-icon'><span>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.FOLLOW"},data:i}))+"</span></button>\n"},30:function(e,t,n,r,i){var s;return"<h3 class='curation-enrollment-status'>["+e.escapeExpression((s=(s=n.curationEnrollmentStatus||(t!=null?t.curationEnrollmentStatus:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"curationEnrollmentStatus",hash:{},data:i}):s))+"]</h3>"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isOnMobile:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/follow",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-signup-modal",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return" "+e.escapeExpression((s=(s=n.signUpHeaderClass||(t!=null?t.signUpHeaderClass:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"signUpHeaderClass",hash:{},data:i}):s))},3:function(e,t,n,r,i){var s;return" style=\"background-image:url('"+e.escapeExpression((s=(s=n.signUpHeaderImage||(t!=null?t.signUpHeaderImage:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"signUpHeaderImage",hash:{},data:i}):s))+"')\""},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return'<div class="signup-modal-body">\n	<div class="head'+((s=n["if"].call(u,t!=null?t.signUpHeaderClass:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"'+((s=n["if"].call(u,t!=null?t.signUpHeaderImage:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'></div>\n	<h3 class="signup-title">'+l((o=(o=n.signUpTitle||(t!=null?t.signUpTitle:t))!=null?o:a,typeof o===f?o.call(u,{name:"signUpTitle",hash:{},data:i}):o))+'</h3>\n	<p class="signup-message">'+l((o=(o=n.signUpMessage||(t!=null?t.signUpMessage:t))!=null?o:a,typeof o===f?o.call(u,{name:"signUpMessage",hash:{},data:i}):o))+'</p>\n	<button class="large action signup-button">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.SIGN_UP_WITH_YAHOO"},data:i}))+'</button>\n</div>\n<div class="signup-modal-footer">\n	<span>'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.HAVE_YAHOO_ACCOUNT"},data:i}))+'</span>\n	<a href="#" class="signin-link">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/signup-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("signup-modal-view",function(e,t){"use strict";var n,r;n={css:{destinationContainer:"body",closeX:".close-x",buttonAction:"button.action",navBarContent:".head .nav",subviewContent:".content.subview",modalContent:".body .content"},options:{}},r={supportsTransform:!1,modal:{height:0,width:0}},e.namespace("Views").SignUpModal=e.FlickrView.create(this.name,e.Views.FluidModal,[],{initializer:function(e){return this.set("showFooter",!1),this.set("showHeader",!1),this.set("showButtonFlavorText",!1),this.set("showButtons",!1),this.set("showActionButton",!1),this.set("showCancelButton",!1),this.set("signUpHeaderClass",e.signUpHeaderClass),this.set("signUpHeaderImage",e.signUpHeaderImage),this.set("signUpTitle",e.signUpTitle),this.set("signUpMessage",e.signUpMessage),this.set("beaconPrefix",e.beaconPrefix),this.set("classList","signup-modal"),this},buildContainer:function(){if(!this.alreadyShowingModal){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalShow");var t={signUpHeaderClass:this.get("signUpHeaderClass"),signUpHeaderImage:this.get("signUpHeaderImage"),signUpTitle:this.get("signUpTitle"),signUpMessage:this.get("signUpMessage")};this.set("htmlMessage",this.templates("signup-modal")(t)),this.constructor.superclass.buildContainer.call(this)}return this},activate:function(){return this.get("container").one(".signup-button").on("click",this.handleAction.bind(this)),this.get("container").one(".signin-link").on("click",this.handleSignIn.bind(this)),this.constructor.superclass.activate.call(this),this},handleSignIn:function(t){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalSignInClick"),this.fire("signInClick",t),this.constructor.superclass.handleAction.call(this)},handleAction:function(t){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalSignUpClick"),this.fire("signUpClick",t),this.constructor.superclass.handleAction.call(this)},handleCancel:function(t){e.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"CancelClick"),this.constructor.superclass.handleCancel.call(this)}})},"@VERSION@",{requires:["flickr-view","fluid-modal-view","hermes-template-signup-modal","signup-modal-css"],optionalRequires:["fluid"],langBundles:["common"]});
YUI.add("hermes-template-dialog-tooltip",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" ui-dialog-tooltip-witharrow"},3:function(e,t,n,r,i){return" drop-up"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<div class="ui-dialog-wrapper ui-dialog ui-dialog-tooltip'+((s=n["if"].call(o,t!=null?t.arrow:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.dropUp:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-action="halt">\n	<span class="ui-dialog-arrow"></span>\n	<div class="ui-dialog-body">\n	'+e.escapeExpression((n.dialogOutlet||t&&t.dialogOutlet||n.helperMissing).call(o,t!=null?t.content:t,{name:"dialogOutlet",hash:{},data:i}))+"\n	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-tooltip",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-dialog-modal",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return'<div class="ui-dialog-wrapper ui-dialog ui-dialog-modal">\n	<div class="ui-dialog-body">\n	'+e.escapeExpression((n.dialogOutlet||t&&t.dialogOutlet||n.helperMissing).call(t!=null?t:{},t!=null?t.content:t,{name:"dialogOutlet",hash:{},data:i}))+"\n	</div>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-dialog-alert",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=e.lambda,u=e.escapeExpression;return'<div class="ui-dialog-wrapper ui-dialog ui-dialog-alert">\n    <div class="dialog-title">\n		<h3>'+u(o((s=t!=null?t.attrs:t)!=null?s.title:s,t))+'</h3>\n		<i class="close-alert ui-dialog-button-close" data-action="dismiss"></i>\n    </div>\n    <div class="dialog-content">\n        <i class="ui-icon-modal-error '+u(o((s=t!=null?t.attrs:t)!=null?s.level:s,t))+'"></i>\n        <div class="alert-dialog-text">\n    	'+u((n.dialogOutlet||t&&t.dialogOutlet||n.helperMissing).call(t!=null?t:{},t!=null?t.content:t,{name:"dialogOutlet",hash:{},data:i}))+'\n    	</div>\n    </div>\n    <button class="ui-button ui-button-cta" data-action="ok">\n        <span>'+u(o((s=t!=null?t.attrs:t)!=null?s.confirmLabel:s,t))+"</span>\n    </button>\n</div>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-alert",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-dialog-cta",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"ui-buttonbar-vertical"},3:function(e,t,n,r,i){var s;return'				<button class="ui-button ui-button-cta" data-action="confirm"><span>'+e.escapeExpression(e.lambda((s=t!=null?t.attrs:t)!=null?s.confirmButtonText:s,t))+"</span></button>\n"},5:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.buttonMarkup:t,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.program(8,i,0),data:i}))!=null?s:""},6:function(e,t,n,r,i){return"					"+e.escapeExpression(e.lambda(t!=null?t.buttonMarkup:t,t))+"\n"},8:function(e,t,n,r,i){var s;return'					<button class="ui-button" '+((s=n["if"].call(t!=null?t:{},t!=null?t.buttonAction:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+"><span>"+e.escapeExpression(e.lambda(t!=null?t.buttonLabel:t,t))+"</span></button>\n"},9:function(e,t,n,r,i){return'data-action="'+e.escapeExpression(e.lambda(t!=null?t.buttonAction:t,t))+'"'},11:function(e,t,n,r,i){var s;return'				<button class="ui-button" data-action="decline"><span>'+e.escapeExpression(e.lambda((s=t!=null?t.attrs:t)!=null?s.cancelButtonText:s,t))+"</span></button>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=e.escapeExpression,u=t!=null?t:{};return'<div class="ui-dialog-wrapper ui-dialog ui-dialog-cta">\n	<h1 class="ui-dialog-title">'+o(e.lambda((s=t!=null?t.attrs:t)!=null?s.title:s,t))+'</h1>\n	<div class="ui-dialog-body">\n		<div class="ui-util-paragraph">\n			'+o((n.dialogOutlet||t&&t.dialogOutlet||n.helperMissing).call(u,t!=null?t.content:t,{name:"dialogOutlet",hash:{},data:i}))+'\n		</div>\n		<div class="ui-buttonbar '+((s=n["if"].call(u,(s=t!=null?t.attrs:t)!=null?s.verticalButtonList:s,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n'+((s=n.unless.call(u,(s=t!=null?t.attrs:t)!=null?s.hideConfirmButton:s,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+"			\n"+((s=n.each.call(u,(s=t!=null?t.attrs:t)!=null?s.additionalButtons:s,{name:"each",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+"			\n"+((s=n["if"].call(u,(s=t!=null?t.attrs:t)!=null?s.useCancelButton:s,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+"		</div>\n	</div>\n</div>\n\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-cta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("dialog",function(e){"use strict";var t,n,r={},i=e.config.win,s=e.config.doc;t={css:{state:"c-state-{{state}}",hidden:"ui-util-hidden",loading:"ui-util-loading",working:"ui-util-working",locked:"ui-util-locked",complete:"ui-util-complete",removed:"ui-util-removed",content:"js-content",wrapper:"ui-dialog-wrapper",anchorSelected:"ui-util-selected",curtain:"ui-dialog-modal-curtain",curtainClear:"ui-dialog-modal-curtain-clear",arrow:"ui-dialog-arrow"},transitionTimeout:2e3,debug:!1},n=e.merge(e.flutil,{log:function(){var e=new Array(arguments.length);for(var r=0;r<e.length;++r)e[r]=arguments[r];if(!t.debug||!console.log.apply)return;e.unshift("DIALOG"),n.dump.apply(null,e)},propagateWrapperAttributes:function(e,n){var r=[],i;return!n||!n.getDOMNode()||!n.getDOMNode().classList?r:(Array.prototype.slice.call(n.getDOMNode().classList).forEach(function(i){if(i===t.css.wrapper)return;n.removeClass(i),e.addClass(i),r.push(i)}),i=n.getAttribute("data-action"),i&&(n.removeAttribute("data-action"),r.push({attr:"data-action",restore:e.getAttribute("data-action")||null}),e.setAttribute("data-action",i)),r)},rollbackWrapperAttributes:function(e,t){if(!t)return;for(var n=0,r=t.length;n<r;n++)typeof t[n]=="object"?t[1].restore?e.setAttribute(t[n].name,t[n].restore):e.removeAttribute(t[n].name):e.removeClass(t[n])}}),e.namespace("Views").dialog={_dialogs:{},getInstance:function(t,r){var i,s,o;return r.id?s={id:r.id}:(s=e.merge(r),delete s.parent,delete s.rootEl,delete s.template,delete s.appContext,typeof s.content=="object"&&s.content instanceof e.FlickrView?s.content=s.content.get("container").toString():typeof s.content=="function"?s.content=s.content({}):s.content.toString()),i="SGL"+n.createHashCode(s),o=this._dialogs[t+":"+i],o?o:this._new(t,i,r)},getNewInstance:function(e,t){var n="OBJ"+(Object.keys(this._dialogs).length+1)+(new Date).getTime();return this._new(e,n,t)},_new:function(t,n,i){var s,o,u,a,f;if(e.Env.isServer)throw new Error("Dialogs are client-only!");i=e.mix(i||{});if(i.parent)o=i.parent,delete i.parent,a=o.getContainer({subviewName:t,subviewParams:i}),u=o.appContext;else{if(!i.appContext)throw new Error('Either the "appContext" or "parent" parameter is required!');o=null,u=i.appContext,a=e.Node.create("<div/>"),a.addClass("view").addClass(t)}return i.appContext=u,i.container=a,s=new r[t](i),f=t+(n?":"+n:""),s._parent=o,this.registerView(s,f),this._navigateCloseHook||(this._navigateCloseHook=u.flapp.on("navigate",this.close.bind(this))),s},registerView:function(e,t){var n=this;t=t||"REG"+(Object.keys(this._dialogs).length+1),e.manager=this,this._dialogs[t]=e,e.on("destroy",function(){delete n._dialogs[t]})},hide:function(e){this.close(e,"hide")},close:function(e,t){var n=this,r;t=t||"close",typeof e=="string"?r=function(r){if(e!==r.split(/:/)[0])return;n._dialogs[r][t]()}:typeof e=="object"?r=function(r){if(e===n._dialogs[r])return;n._dialogs[r][t]()}:r=function(e){n._dialogs[e].get("autoCloseable")&&n._dialogs[e][t]()},Object.keys(this._dialogs).forEach(r)},isOpen:function(e){},util:n},e.namespace("Views").dialogs=r,r["dialog-base"]=e.Base.create("dialog-base",e.FlickrView,[],{initializer:function(e){return e=e||{},this.state={},this.manager=null,this.appContext=this.appContext||e.appContext,this},render:function(){var n=this.templates(this.get("template"))(this.toJSON());return this.setContainerHTML(n),e.namespace("Views").dialog.util.propagateWrapperAttributes(this.get("container"),this.get("container").one("."+t.css.wrapper)),this.renderContent(),this.activate(),this.get("container").addClass(t.css.hidden),this.anchorToLayout(),this.state.visible=!0,this.hide(),this.state.rendered=!0,this.fire("rendered"),this},renderContent:function(r){var i=this.get("content"),s=this.get("container"),o=s.one("."+t.css.content);e.namespace("Views").dialog.util.rollbackWrapperAttributes(this.get("container"),this._contWrap);if(i instanceof e.FlickrView){i=i.get("container");if(!i)throw new Error("The Content View doesn't have a container");o.setHTML(""),o.appendChild(i)}else i instanceof e.Node?(o.setHTML(""),o.appendChild(i)):typeof i=="function"?(i=i(e.merge(this.toJSON(),r)),o.setHTML(i)):typeof i=="string"&&this.state.rendered&&o.setHTML(i);this._contWrap=n.propagateWrapperAttributes(s,o.one("."+t.css.wrapper))},renderCurtain:function(){var n=this,r,i=e.Number.parse(this.get("tintCurtain"));this.get("curtain")||(r=e.Node.create("<div/>"),r.addClass(t.css.curtain).addClass(t.css.hidden),this.get("visibleShim")||r.addClass(t.css.curtainClear),r.on("click",this.dismiss,this),i&&r.setStyle("backgroundColor","rgba(0, 0, 0, "+i+")"),this.set("curtain",r),this.get("appendCurtainTo")?this.get("appendCurtainTo").appendChild(r):this.get("container").ancestor()&&this.get("container").ancestor().insert(r,"after")),n.get("curtain").removeClass(t.css.hidden)},anchorToLayout:function(){var t=this.get("container"),n=this.get("anchorTo"),r,i=this.get("appendTo")||n||this.get("rootEl");if(!i){var s=new Error("Missing DOM node for anchoring dialog.");throw e.config&&e.config.win&&e.config.win.beaconError&&e.config.win.beaconError("dialogjs.failure "+(this._parent?this._parent.name:""),e.config.win.location.href,s),s}i.appendChild(t),this.get("positioning")?(this.get("dropUp")&&(r="bottomright"),this.refreshPosition(r)):this.manualPosition()},refreshPosition:function(n){var r,s,o,u,a,f,l,c,h=this.get("container"),p=this.get("anchorTo"),d=this.get("offsetLeft")||0,v,m;u=h.getDOMNode().getBoundingClientRect(),this.set("width",h.getComputedStyle("width")),this.set("height",h.getComputedStyle("height")),h.getComputedStyle("position")==="fixed"&&h.setStyles({marginLeft:(-1*u.width/2|0)-d+"px",marginTop:(-1*u.height/2|0)+"px"});if(p){r=p.getDOMNode().getBoundingClientRect(),this.set("anchorWidth",r.width),this.set("anchorHeight",r.height),m=e.merge({top:0,bottom:0,left:0,right:0},this.get("constraints")),c={top:m.top,bottom:i.innerHeight+m.bottom,left:m.left,right:i.innerWidth+m.right},a=[[r.bottom+u.height<c.bottom&&
r.right+u.width<c.right,{left:0,top:r.height},"topleft"],[r.bottom+u.height<c.bottom&&r.left-u.width>c.left,{right:0,top:r.height},"topright"],[r.top>u.height+c.top&&r.right+u.width<c.right,{left:0,bottom:r.height},"bottomleft"],[r.top>u.height+c.top&&r.left-u.width>c.left,{right:0,bottom:r.height},"bottomright"],[!0,{left:Math.round(-1*(u.width-r.width)/2),top:r.height},"topcenter"]],n&&(n=n.toLowerCase(),a=a.filter(function(e){return e[2]===n?(e[0]=!0,!0):!1})||a);while(a.length){l=a.shift();if(l[0]){f=l[1],h.addClass("ui-dialog-tooltip-witharrow-"+l[2]),h.setStyles(e.mix({top:"auto",bottom:"auto",left:"auto",right:"auto"},f,!0));break}}v=h.one("."+t.css.arrow),v&&(s=20,f.left!==0&&f.right!==0?o=Math.round((u.width-s)/2)+"px":o=Math.round((r.width-s)/2)+"px",v.setStyles({right:f.right===undefined?"auto":o,left:f.left===undefined?"auto":o}))}},manualPosition:function(){if(this.get("arrow")){var e=typeof this.get("arrow")=="string"?this.get("arrow"):"topleft";this.get("container").addClass("ui-dialog-tooltip-witharrow-"+e)}},activate:function(){var e={":confirm":this.confirm,":decline":this.decline,":dismiss":this.dismiss,":ok":this.dismiss,":halt":function(e){e.halt()}};return this.attachEvents(e),this},toJSON:function(){var t=this.getAttrs();return Object.keys(t).reduce(function(n,r){var i=t[r];return i instanceof e.Node?n:i instanceof e.FlickrView?n:(i&&i.toJSON&&(i=i.toJSON()),n[r]=i,n)},{})},isVisible:function(){return!!this.state.visible},isLocked:function(){return!!this.state.locked},isWorking:function(){return!!this.state.working},show:function(r){try{var i=this,s=this.get("container"),o=this.get("anchorTo");this.set("dismissing",!1),this.switchToLoading(!1);if(this.state.visible)return;this.state.rendered||this.render(),i.state.visible=!0,s.addClass(this.get("dialogClass")),this.fire("show"),s.removeClass(t.css.removed),setTimeout(function(){n.onTransitionEnd(s,r),s.removeClass(t.css.hidden),o&&o.addClass(t.css.anchorSelected)},10),e.fire("flickr:setKeyEventScope",this.getKeyEventScope())}catch(u){console&&console.error&&console.error("An error occured showing the dialog.")}},handleError:function(e){return function(t){console.error(e,!t.toString||t.toString().match(/^\[object/)?t:t.toString())}},getKeyEventScope:function(){return this.name+this._yuid},close:function(e){if(this._destroyed)return;var t=this;this.set("dismissing",!1),this.fire("close"),this.hide(function(){t.destructor(),e&&e()})},destructor:function(){var t=this.get("container");t.detach(),t.remove(),this.set("container",null),this.set("content",null),this.set("appendTo",null),this.set("anchorTo",null),this.set("rootEl",null),this.set("dialogClass",null),this.manager=null,e.FlickrView.prototype.destroy.call(this),this._destroyed=!0,this.fire("destroy"),this.detachAll()},hide:function(r){e.fire("flickr:removeKeyEventScope",this.getKeyEventScope());if(!this.state.visible)return;var i=this,s=this.get("container"),o=this.get("anchorTo"),u=this.get("curtain"),a=!this.state.rendered;this.state.visible=!1,o&&o.removeClass(t.css.anchorSelected),u?(this.set("curtain",null),u.detach(),this.get("dismissCurtainImmediately")?(u.addClass(t.css.hidden),u.remove()):(n.onTransitionEnd(u,function(){u.remove()}),u.addClass(t.css.hidden))):s.addClass(t.css.removed),e.namespace("Views").dialog.util.onTransitionEnd(s,function(){i.set("dismissing",!1),a||i.fire("hide"),i.state.visible||s.addClass(t.css.removed),r&&r()}),s.addClass(t.css.hidden)},toggle:function(e){this[this.state.visible?"hide":"show"](e),this.fire("toggle",this.state.visible)},switchToLoading:function(e){this.switchToUIState("loading",e)},switchToComplete:function(e){this.switchToUIState("complete",e)},switchToLocked:function(e){this.switchToUIState("locked",e)},switchToWorking:function(e){this.switchToUIState("working",e)},switchToUIState:function(e,n){var r;n=n===!1?!1:!0;if(this.state[e]===n)return;this.state[e]=n,r=t.css[e]||t.css.state.replace(/\{\{state\}\}/,e),this.get("container")[n?"addClass":"removeClass"](r)},confirm:function(t,n){t.halt(),this.fire("confirm",n),this.get("hideOnButtonClick")&&this.hide(),e.namespace("Views").dialog.util.log("CONFIRM")},decline:function(t,n){t.halt(),this.fire("decline",n),this.get("hideOnButtonClick")&&this.hide(),e.namespace("Views").dialog.util.log("DECLINE")},dismiss:function(t,n){if(this.isWorking()||!this.get("hideOnCurtainClick"))if(t.target===this.get("curtain"))return;this.set("dismissing",!0),t.halt(),this.fire("dismiss",n),this.hide(),e.namespace("Views").dialog.util.log("DISMISS")}},{ATTRS:{template:{value:"dialog"},anchorTo:{value:null},offsetLeft:{value:0},appendTo:{value:null},appendCurtainTo:{value:null},hideOnCurtainClick:{value:!0},tintCurtain:{value:0},rootEl:{value:e.Node&&e.one(s&&s.body)},content:{value:null},attrs:{value:{}},stack:{value:!1},hideOnButtonClick:{value:!0},visibleShim:{value:!0},positioning:{value:!0},arrow:{value:!1},dropUp:{value:!1},constraints:{value:{}},dialogClass:{value:""},autoCloseable:{value:!0},dismissCurtainImmediately:{value:!1}}}),r["dialog-tooltip"]=e.Base.create("dialog-tooltip",r["dialog-base"],[],{show:function(){this.get("stack")||this.manager&&this.manager.close&&this.manager.close(this),r["dialog-base"].prototype.show.apply(this,arguments),this.renderCurtain()}},{ATTRS:{template:{value:"dialog-tooltip"},offsetLeft:{value:0},visibleShim:{value:!1}}}),r["dialog-modal"]=e.Base.create("dialog-modal",r["dialog-base"],[],{anchorToLayout:function(){this.set("anchorTo",null),r["dialog-base"].prototype.anchorToLayout.apply(this,arguments)},show:function(e,t){var n=t||{},i=n.hideOthers||!1;i?this.get("stack")||this.manager.hide(this):this.get("stack")||this.manager.close(this),r["dialog-base"].prototype.show.call(this,e),this.renderCurtain()}},{ATTRS:{template:{value:"dialog-modal"}}}),r["dialog-alert"]=e.Base.create("dialog-alert",r["dialog-base"],[],{show:function(){this.get("stack")||this.manager.close(this),r["dialog-base"].prototype.show.apply(this,arguments),this.renderCurtain
()}},{ATTRS:{template:{value:"dialog-alert"},offsetLeft:{value:0},visibleShim:{value:!1}}}),r["dialog-cta"]=e.Base.create("dialog-cta",r["dialog-base"],[],{show:function(){this.get("stack")||this.manager.close(this),r["dialog-base"].prototype.show.apply(this,arguments),this.renderCurtain()},hide:function(){this.get("curtain")&&(this.get("curtain").remove(),this.set("curtain",null)),r["dialog-base"].prototype.hide.apply(this,arguments)}},{ATTRS:{template:{value:"dialog-cta"},offsetLeft:{value:0},visibleShim:{value:!1}}}),r["dialog-progress"]=e.Base.create("dialog-progress",r["dialog-base"],[],{},{ATTRS:{template:{value:"dialog-progress"}}}),e.Handlebars.registerHelper("dialogOutlet",function(n){var r=['<div class="'+t.css.content+'">'];return n instanceof e.FlickrView||n instanceof e.Node?r.push("<!--"+(n.name||"DOM-node")+"-->"):r.push((n||"")+""),r.push("</div>"),new e.Handlebars.SafeString(r.join(""))})},"@VERSION@",{requires:["flickr-view","handlebars-base","flutil","hermes-template-dialog-tooltip","hermes-template-dialog-modal","hermes-template-dialog-alert","hermes-template-dialog-cta","flickrui-css"]});
YUI.add("hermes-template-following-dropdown",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'			<label class = "checked">\n				<input type="checkbox" checked="checked" id="friend-checkbox" />\n'},3:function(e,t,n,r,i){return'			<label>\n				<input type="checkbox" id="friend-checkbox" />\n'},5:function(e,t,n,r,i){return'			<label class="checked">\n				<input type="checkbox" checked="checked" id="family-checkbox" />\n'},7:function(e,t,n,r,i){return'			<label>\n				<input type="checkbox" id="family-checkbox" />\n'},9:function(e,t,n,r,i){return'			<button class="follow unfollow">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNFOLLOW"},data:i}))+"</button>\n"},11:function(e,t,n,r,i){return'			<a href="#"><i class="ui-icon-tiny-unfollow"></i> '+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNFOLLOW"},data:i}))+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'<ul>\n	<li class="following-friend">\n'+((s=n["if"].call(o,t!=null?t.isFriend:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"			"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.FRIEND"},data:i}))+'\n		</label>\n	</li>\n	<li class="following-family">\n'+((s=n["if"].call(o,t!=null?t.isFamily:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:"")+"			"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.FAMILY"},data:i}))+'\n		</label>\n	</li>\n	<li class="divider"></li>\n	<li class="following-unfollow">\n'+((s=n["if"].call(o,t!=null?t.isFluid:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.program(11,i,0),data:i}))!=null?s:"")+"	</li>\n</ul>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/following-dropdown",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("relationship-menu-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.relationship=t,e.nsid=e.nsid||t.id})},buildContainer:function(){return this.setContainerWithTemplate("following-dropdown",{isFriend:this.relationship.getValue("isFriend"),isFamily:this.relationship.getValue("isFamily"),isFluid:!0}),this},activate:function(){var e=this.get("container"),t=this;return this.registerEventHandler(this.relationship.on("valuesChanged",function(){t.buildContainer()})),this.registerEventHandler(e.delegate("click",function(e){t.handleUnfollowClick(e)},".following-unfollow")),this.registerEventHandler(e.delegate("change",function(e){t.handleFriendChange(e)},".following-friend input")),this.registerEventHandler(e.delegate("change",function(e){t.handleFamilyChange(e)},".following-family input")),this},handleUnfollowClick:function(t){var r=this;t.preventDefault(),this.relationship.getValue("isContact")&&(this.relationship.registry.toggleFollowing(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){r.relationship.setValue("isContact",!0),r.buildContainer(),n.error({err:e})}),e.rapidTracker.beacon(this.name,"unfollowButtonClick"),this.fire("onUnfollow"))},handleFriendChange:function(t){var r=this;this.relationship.registry.toggleFriend(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){r.relationship.registry.toggleFriend(r.nsid),r.buildContainer(),r.onError(r.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),n.error({err:e})})},handleFamilyChange:function(t){var r=this;this.relationship.registry.toggleFamily(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){r.relationship.registry.toggleFamily(r.nsid),r.buildContainer(),r.onError(r.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),n.error({err:e})})}})},"@VERSION@",{requires:["promise","fluid-css","hermes-template-following-dropdown","relationship-menu-css"],langBundles:["common","person"]});
YUI.add("hermes-lang-person",function(e,t){e.Intl.add("hermes/person","en-US",{MESSAGE:["Message"],ALBUMS:["Albums"],FAVES:["Faves"],PROFILE:["Profile"],NO_PHOTOS:["This user has no photos visible to you."],NO_LONGER_ON_FLICKR:["This user is not found, or no longer on Flickr."],ERROR_LOADING:["Error loading user card. Please try again."],RELATIONSHIP_FRIEND_ERROR:["There was a problem setting your friend relationship."],RELATIONSHIP_FAMILY_ERROR:["There was a problem setting your family relationship."],SIGN_IN_BEFORE_FOLLOW_TITLE:["You found someone to follow!"],SIGN_IN_BEFORE_FOLLOW_MESSAGE:["That's awesome. Just sign in to follow them."],JOIN_FLICKR_AND_FOLLOW:["Join Flickr to never miss a post from ","${person}","."],SIGN_IN_AND_FOLLOW:["Sign in and follow"],CURATOR_PASS_OVER:["Pass over"],CURATOR_PASS_OVER_UNDO:["Undo pass over"]})},"@VERSION@",{requires:["intl"]});
YUI.add("follow-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("isActiveViewAgnostic",e.isActiveViewAgnostic),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.realFullscreen=!!e.realFullscreen,this.isFluid=e.isFluid,this.isOnDark=e.isOnDark,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.isOnMobile=e.isOnMobile,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.set("relationship",t),e.nsid=e.nsid||t.id})},buildContainer:function(){var e=this.get("relationship");return this.setContainerWithTemplate("follow",{showNoButton:e.getValue("isMe")||e.getValue("isIgnoredBy"),showUnblockButton:e.getValue("isIgnored"),showFollowingButton:e.getValue("isContact"),signedIn:this.appContext.getViewer().signedIn,isFluid:this.isFluid,isOnMobile:this.isOnMobile,isOnDark:this.isOnDark,followIntlKey:"common.FOLLOW",followingIntlKey:"common.FOLLOWING"}),this},activate:function(){var t=this,r=this.get("container"),i=this.get("relationship"),s,o;return this.isFluid&&!i.getValue("isMe")?this.registerEventHandler(r.delegate("click",function(r){e.rapidTracker.beacon(this.name,"followButtonClick"),s=r.target.hasClass("follow")?r.target:r.target.ancestor(".follow"),t.appContext.getViewer().signedIn?i.getValue("isIgnored")?(i.registry.toggleIgnore(t.nsid),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls(),i.registry.remoteUpdate(t.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){i.setValue("isIgnored",!0),t.buildContainer(),n.error({err:e})})):i.getValue("isContact")?(s.addClass("is-open"),o&&o.destroy(),o=new e.Views.FluidDroparound({appContext:t.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:140,height:130,observePageResize:!0,anchorOffsetHorizontal:6,anchorElement:s.one(".drop-icon"),subview:new e.Views["relationship-menu-view"]({nsid:t.nsid,pathAlias:t.pathAlias,disableRefreshOnRelationshipChange:t.disableRefreshOnRelationshipChange}),preferLeft:!0}),o.on("closeDroparound",function(){s.removeClass("is-open"),t.fire("subviewViewEvent","isClosed")}),o.show(),t.fire("subviewViewEvent","isOpen"),o.get("subview").on("onUnfollow",function(){o.close(),o.destroy(),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls()})):t.followPerson():t.signInAndRedirectToPerson()},"button.follow")):(r&&r.one("button")&&this.registerEventHandler(r.one("button").on("click",t.handleRelationshipClick,t)),this.get("relationship").getValue("isMe")||this.setupDropdown()),t},followPerson:function(){var t=this,r=this.get("relationship");r.getValue("isContact")||(r.registry.toggleFollowing(this.nsid),t.disableRefreshOnRelationshipChange?this.buildContainer():this.showBalls(),r.registry.remoteUpdate(this.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){t.hideBalls(),r.setValue("isContact",!1),t.buildContainer(),n.error({err:e})}))},showBalls:function(){this.balls||(this.balls=e.Node.create(this.templates("flickr-balls")({}))),this.get("container").append(this.balls),this.balls.show(),this.get("container").one(".follow").hide()},hideBalls:function(){this.balls&&(this.balls.remove(),this.get("container").one(".follow").show())},handleRelationshipClick:function(t){var n=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"followButtonClick");var r=this.get("relationship").getValue("isContact");this.appContext.getViewer().signedIn?r===!1?(this.followPerson(),e.rapidTracker.beacon(this.name,"photoAttributionFollowButtonClick")):n.isOnMobile?n.handleUnfollowClick(t):(n.relationshipDropDownDialog.toggle(),e.rapidTracker.beacon(this.name,"photoAttributionFollowMenuClick")):n.isOnMobile?e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:n.appContext.getUA().os,isWebview:n.appContext.getUA().isWebview,pageURL:"/photos/"+n.nsid,beacon:{name:"mpp_follow_signedout",section:"attribution-view"},viewName:n.name})}):n.signInAndRedirectToPerson()},handleFriendChange:function(t){var r=this;this.get("relationship").registry.toggleFriend(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").registry.toggleFriend(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),n.error({err:e})}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleFamilyChange:function(t){var r=this;this.get("relationship").registry.toggleFamily(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").registry.toggleFamily(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),n.error({err:e})}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleUnfollowClick:function(t){var r=this;t.preventDefault(),this.get("relationship").registry.toggleFollowing(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.isOnMobile||this.relationshipDropDownDialog.toggle(function(){this.toggleFollowingButton(t.target
.ancestor(".relationship").one("button"),this.get("relationship").getValue("isContact"))}.bind(this)),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").setValue("isContact",!0),this.toggleFollowingButton(t.target.ancestor("button"),!0),n.error({err:e})}.bind(this)),e.rapidTracker.beacon(this.name,"photoAttributionUnfollowButtonClick")},toggleFollowingButton:function(e,t){t?(e.setContent("<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>"),e.addClass("follow-anim").addClass("is-following"),setTimeout(function(){e.removeClass("follow-anim")},500),e.addClass("ui-button-dropdown")):(e.addClass("unfollow-anim").removeClass("is-following"),setTimeout(function(){e.removeClass("unfollow-anim")},500),e.one("span").setContent(this.intlMessage({intlName:"common.FOLLOW"})),e.removeClass("ui-button-dropdown"))},onError:function(t){var n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1});n.show()},setupDropdown:function(){var t=this,n=t.get("container"),r,i=n.one(".relationship"),s,o=n.one(".relationship button");if(!i)return;s=this.templates("following-dropdown")({isFriend:this.get("relationship").getValue("isFriend"),isFamily:this.get("relationship").getValue("isFamily")}),this.relationshipDropDownDialog=e.Views.dialog.getNewInstance("dialog-tooltip",{content:s,anchorTo:n.one(".relationship"),positioning:!1,parent:this}),this.registerEventHandler(this.relationshipDropDownDialog.on("hide",function(e){o.removeClass("is-open")})),this.registerEventHandler(this.relationshipDropDownDialog.on("show",function(e){o.addClass("is-open")})),this.relationshipDropDownDialog.render(),r=this.relationshipDropDownDialog.get("container"),r.detach("click"),this.registerEventHandler(r.one(".following-unfollow").on("click",this.handleUnfollowClick,this)),this.registerEventHandler(r.one(".following-friend input").on("change",this.handleFriendChange,this)),this.registerEventHandler(r.one(".following-family input").on("change",this.handleFamilyChange,this))},showSignUpModal:function(){var t=this;this.appContext.getModel("person-models",this.nsid).then(function(n){var r=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,i=t.intlMessage({intlName:"person.JOIN_FLICKR_AND_FOLLOW",person:n.getValue("displayname")}),s=n.getValue("buddyicon"),o;s.displayUrl=s.retina||s.large||s.medium||s.default,o=new e.Views.SignUpModal({appContext:t.appContext,signUpHeaderClass:"avatar person large no-menu no-edit",signUpHeaderImage:s.displayUrl,signUpTitle:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),signUpMessage:i,beaconPrefix:"follow"}),o.on("signUpClick",function(n){e.SigninHelper.signUpPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.on("signInClick",function(n){e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.show()})},signInAndRedirectToPerson:function(){var t=this,n=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,r=t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_MESSAGE"}),i=t.intlMessage({intlName:"person.SIGN_IN_AND_FOLLOW"}),s=t.intlMessage({intlName:"common.CANCEL"}),o;if(this.signedOutTest)return this.showSignUpModal();o=new e.Views.FluidModal({appContext:t.appContext,title:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),htmlMessage:r,actionButtonLabel:i,cancelButtonLabel:s}),o.on("actionClick",function(){e.rapidTracker.beacon(t.name,"followModalSigninClick"),e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:n})}),o.on("cancelClick",function(n){e.rapidTracker.beacon(t.name,"followModalCancelClick")}),o.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-follow","follow-css","promise","fluid-droparound-view","fluid-modal-view","signup-modal-view","dialog","hermes-template-following-dropdown","hermes-template-flickr-balls","fluid-balls-css","relationship-menu-view","signin-helper"],optional:["person-models","person-relationship-models"],langBundles:["common","person"]});
YUI.add("attribution-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.hideFollowView}}},initializer:function(e){return this.nsid=e.nsid,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.realFullscreen=!!e.realFullscreen,this.hideFollowView=e.hideFollowView?e.hideFollowView:!1,this.isAlbumView=e.isAlbumView,this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("person-models",t.nsid)]).then(function(e){t.set("owner",e[0])})},buildContainer:function(){var e=this.get("owner"),t=this.get("container"),n=e.getValue("pathAlias")||e.getValue("nsid"),r,i=this;return this.albumPhotoListLayoutStyle==="justified"&&t.addClass("justified-album-details-page"),r=e.getValue("buddyicon").large?e.getValue("buddyicon").large:e.getValue("buddyicon")["default"],this.setContainerWithTemplate("attribution",{isPro:i.appContext.flipper.isFlipped("enable-pro-badge")?e.getValue("isPro"):!1,pathAlias:n,buddyicon:r,nsid:e.getValue("nsid"),displayname:e.getValue("displayname"),realFullscreenEnabled:this.realFullscreen&&this.appContext.experiments.fullscreen.getMode(),isAlbumView:this.isAlbumView}),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-attribution","photo-attribution-css","promise","follow-view"],optional:["person-models"],langBundles:["attribution"]});
YUI.add("album-header-view",function(e,t){var n=require("lib/flog")(t),r=.8,i=480,s=60,o={css:{headerContent:".album-header-content"}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"album-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-stats-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,hideFollowView:!0,additionalViewClasses:["album-attribution"],isAlbumView:!0}},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("set-models",this.albumId)),this.appContext.getViewer().signedIn&&n.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid)),e.Promise.all(n).then(function(e){t.set("albumModel",e[0]),e[1]&&t.set("personPreferenceModel",e[1])})},buildContainer:function(){var e,t=this.get("container"),i=this.getAlbumHeaderHeight()-s,o=this.get("albumModel"),u=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===o.getValue("owner").id,a=this.appContext.viewportData.getDevicePixelRatio();return this.albumPhotoListLayoutStyle==="justified"&&(t.addClass("justified-transitions"),t.addClass("justified"),i=300),e=o.registry.getSizeToFit(this.albumId,{width:this.appContext.viewportData.getWidth()*r*a,height:i*a}),e||n.error("Failed to load album coverphoto."),this.setContainerWithTemplate("album-header",{height:i,"cover-photo-url":e?e.url:"",viewerIsOwner:u}),this},buildErrorContainer:function(){},activate:function(){var t=this,n=this.get("container"),r=n.one(".edit-cover-photo"),i=n.one(".album-header-content"),u=n.one(".avatar"),a,f=this.get("personPreferenceModel");this.albumHeaderElement=this.get("container").one(o.css.headerContent),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.resizeHeader.bind(this))),r&&this.registerEventHandler(r.on("click",this.handleSetCoverPhotoClick.bind(this)));if(this.appContext.flipper.isFlipped("enable-change-album-sorting")){var l=this.get("container").one(".change-album-sorting");l&&this.registerEventHandler(l.on("click",this.handleChangeAlbumSorting.bind(this)))}e.on("albumToolbarView:layoutChange",function(r){f&&(f.setValues({albumViewLayoutPref:r}),f.remoteUpdate()),r==="justified"?(n.addClass("justified-transitions"),n.addClass("justified"),i.setStyle("height",300),u&&e.flutil.onTransitionEnd(u,function(){n.one(".album-attribution").addClass("justified-album-details-page")})):(a=t.getAlbumHeaderHeight()-s+"px",i.setStyle("height",a),n.removeClass("justified"),u&&setTimeout(function(){n.one(".album-attribution").removeClass("justified-album-details-page")},250),e.flutil.onTransitionEnd(i,function(){n.removeClass("justified-transitions")}))})},onSubviewEvent:function(e,t){var n=this.get("container"),r=n.one(".album-header-content"),i=n.one(".edit-cover-photo");if(e==="album-title-desc-view"&&t[0]==="albumTitleDesc:editing")return this.fire("parentViewEvent","albumHeaderView:editing"),i.addClass("hidden"),!1;if(e==="album-title-desc-view"&&t[0]==="albumTitleDesc:doneEditing")return this.fire("parentViewEvent","albumHeaderView:doneEditing"),i.removeClass("hidden"),!1;e==="album-title-desc-view"&&t[0]==="albumTitleDescEditing:heightChange"&&t[1]&&r.setStyle("height",parseInt(r.getComputedStyle("height"),10)+t[1]+"px")},resizeHeader:function(e){var t=this.getAlbumHeaderHeight()-s,n=this.get("container");n.hasClass("justified")||this.albumHeaderElement.setStyle("height",t)},getAlbumHeaderHeight:function(){var e=this.appContext.viewportData.getWidth(),t=this.appContext.viewportData.getHeight()-50,n=1.3,r=2.3,s=2.75,o=120,u=e/n+o,a=e/r+o,f=e/s,l;return t>u?l=e/n:t>a?l=t-o:t>f?l=t-o+o*(t-a)/(f-a):l=t,Math.max(i,Math.round(l))},handleChangeAlbumSorting:function(t){if(!this.appContext.flipper.isFlipped("enable-change-album-sorting"))return;t.halt();var n=this;this.sortingOptionsDialog=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target,minVerticalSpace:250,positionFixed:!0,anchorOffsetHorizontal:14,menuItems:[{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_NEWEST"}),value:"date-posted-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_OLDEST"}),value:"date-posted-desc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_OLDEST"}),value:"date-taken-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_NEWEST"}),value:"date-taken-desc"},{text:this.intlMessage({intlName:"album-page.SORT_ALPHABETICALLY"}),value:"title"},{text:this.intlMessage({intlName:"album-page.SORT_RANDOMLY"}),value:"random"},{text:this.intlMessage({intlName:"album-page.SORT_REVERSE"}),value:"reverse"}]}),this.registerEventHandler(this.sortingOptionsDialog.on("selected",function(t){t.preventDefault(),n.sortingOptionsDialog.close();if(t.menuItem&&t.menuItem.value){var r={photoset_id:n.get("albumModel").getValue("id"),sort:t.menuItem.value,preview:0};n.loadingModal=new e.Views.FluidModal({appContext:this.appContext,title:n.intlMessage({intlName:"common.LOADING"}),message:n.intlMessage({intlName:"album-page.SORT_ALMOST_DONE"}),showButtons:!1}),n.loadingModal.show(),n.appContext.callAPI("flickr.photosets.sortPhotos",r).then(n.onAlbumSortingChanged.bind(n)).catch(n.onAlbumSortingFailed.bind(n))}})),this.sortingOptionsDialog.show()},onAlbumSortingChanged:function(t){t.stat==="ok"?e.config.win.location.reload():this.onAlbumSortingFailed(t)},onAlbumSortingFailed:function(t){if(t.stat==="fail"){var n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:"Error while changing sort",actionButtonLabel:this.intlMessage
({intlName:"common.OK"}),showCancelButton:!1});n.show()}},handleSetCoverPhotoClick:function(t){t.preventDefault();var n=this.get("container"),i=this,o=this.get("albumModel"),u=this.templates("flickr-balls")({}),a=n.one(".edit-cover-photo"),f,l,c,h=this.appContext.viewportData.getDevicePixelRatio();f=new e.Views.FluidModal({appContext:i.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:"",navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:i.appContext,links:[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],enableSearch:!0,enableMarketplaceProductsSearch:!1}),actionButtonLabel:this.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!0,subview:new e.Views["photo-selector-view"]({appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1},defaultSelected:{id:i.albumId,title:i.get("albumModel").getValue("title"),type:"set"}}),width:752,height:498,fullWindow:!0,classList:"photo-selector",hideModalOverlay:!1}),f.on("actionClick",function(t){a.replace(u);var p=f.get("subview").get("selected");this.appContext.getModel("photo-models",p).then(function(e){return o.hasPhoto(p)===!1?c=o.registry.remote.addPhoto({setID:i.albumId,photoID:p},i.appContext).then(function(){return i.fire("subviewViewEvent","newPhotoAddedToAlbum",p),o.registry.remote.setPrimaryPhoto({photoId:p,albumId:i.albumId},i.appContext)}):c=o.registry.remote.setPrimaryPhoto({photoId:p,albumId:i.albumId},i.appContext),c.then(function(t){l=e.getSizeToFit({width:i.appContext.viewportData.getWidth()*r*h,height:(i.getAlbumHeaderHeight()-s)*h}),o.setValue("primary",e.id),o.setValue("primaryPhotoSizes",e.getValue("sizesForAlbum")),o.setValue("primaryNeedsInterstitial",e.getValue("needsInterstitial")),l&&n.one(".album-header-content").setStyle("background-image","url("+l.url+")"),n.one(".balls").replace(a)})}).then(null,function(t){var r=new e.Views.FluidModal({title:i.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:i.intlMessage({intlName:"common.OK"}),textMessage:i.intlMessage({intlName:"album-page.ERROR_COVER_PHOTO"}),appContext:i.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!0});r.show(),n.one(".balls").replace(a)})}),f.registerEventHandler(e.on("photoSelector:selected",function(e){f.enableActionButton()})),f.registerEventHandler(e.on("photoSelector:unselected",function(e){f.disableActionButton()})),e.rapidTracker.beacon(i.name,"albumCoverPhotoEdit"),f.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-header","hermes-template-flickr-balls","album-header-css"],optional:["album-title-desc-view","album-stats-view","album-engagement-view","photo-selector-view","fluid-modal-nav-bar-view","photo-list-photo-interaction-view","attribution-view"],langBundles:["album-page","global-nav","common"]});
YUI.add("hermes-lang-global-nav",function(e,t){e.Intl.add("hermes/global-nav","en-US",{FLICKR_LOGO_ALT:["Flickr logo. If you click it, you'll go home"],YOUR_PHOTOSTREAM:["Your Photostream"],FOLLOWING:["Following"],PHOTOS_OF:["Photos of"],PHOTOS_FROM:["Photos from"],LIST:["List"],COMMUNITIES:["Communities"],GROUPS_LIST:["Groups List"],SEARCH_GROUPS:["Search Groups"],RECENT_DISCUSSIONS:["Recent Discussions"],CREATE_A_GROUP:["Create a Group"],RECENT_PHOTOS:["Recent Photos"],THE_COMMONS:["The Commons"],GETTY_COLLECTION:["Getty Collection"],GALLERIES:["Galleries"],FLICKR_GALLERIES:["Flickr Galleries"],WORLD_MAP:["World Map"],APP_GARDEN:["App Garden"],THE_WEEKLY_FLICKR:["The Weekly Flickr"],FLICKR_BLOG:["Flickr Blog"],UPLOAD:["Upload"],SIGN_IN:["Sign In"],SEARCH:["Search"],CAMERA_FINDER:["Camera Finder"],RECENT_ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],CREATIONS:["Creations"],FIND_FRIENDS:["Find Friends"],GROUPS:["Groups"],PEOPLE:["People"],CAMERAROLL:["Camera Roll"],CREATE:["Create"],UPLOAD_MODAL_SIGNUP_TITLE:["Upload your photos securely and privately!"],UPLOAD_MODAL_SIGNUP_MESSAGE:["Join Flickr to unlock 1,000GB of free photo storage."]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-darla-script-setup",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i,s,o){var u;return"<script>\n	var lang = '"+e.escapeExpression(e.lambda((u=o[1]!=null?o[1].selectedLang:o[1])!=null?u.code:u,t))+'\';\n\n	if (lang === \'de-DE\') {\n		/* this should run out of band */\n		setTimeout(function () {\n			var darlaScriptElement = document.createElement("script");\n			darlaScriptElement.setAttribute("defer", "true");\n			darlaScriptElement.setAttribute("async", "true");\n			darlaScriptElement.setAttribute("src", "https://fc.yahoo.com/sdarla/php/client.php?f=2022219890&l=RS&npv=1&ref=https%3A//flickr.com&rtype=boot");\n			// for the future -- darlaScriptElement.onerror = function(){};\n			document.getElementsByTagName(\'head\')[0].appendChild(darlaScriptElement);\n		}, 100);\n	}\n</script>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i,s,o){var u;return(u=(n.isFlipped||t&&t.isFlipped||n.helperMissing).call(t!=null?t:{},"enable-darla-beacon",{name:"isFlipped",hash:{},fn:e.program(1,i,0,s,o),inverse:e.noop,data:i}))!=null?u:""},useData:!0,useDepths:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/darla-script-setup",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-footer-full",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'<div class="foot-mobile-banner">\n	<a class="server-only-link" href="'+a((s=(s=n.pageUrl||(t!=null?t.pageUrl:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"pageUrl",hash:{},data:i}):s))+'">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.TRY_MDOT"},data:i}))+"</a>\n</div>\n"},3:function(e,t,n,r,i){var s;return'				<li class="foot-li">\n					<a class="opt-out-www server-only-link" href="'+e.escapeExpression((s=(s=n.pageUrl||(t!=null?t.pageUrl:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"pageUrl",hash:{},data:i}):s))+'">flickr.com</a>\n				</li>\n'},5:function(e,t,n,r,i){var s;return'	<span id="tgt"><div id="tgtRS"></div></span>\n'+((s=e.invokePartial(r["darla-script-setup"],t,{name:"darla-script-setup",data:i,indent:"	",helpers:n,partials:r,decorators:e.decorators}))!=null?s:"")},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression,l=e.lambda;return((s=n["if"].call(u,t!=null?t.isOptedOutOfMobile:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+'<footer class="foot">\n	<div class="foot-container">\n		<div class="foot-top-row">\n			<ul class="foot-nav-ul">\n\n'+((s=n["if"].call(u,t!=null?t.hasNoOptOut:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n				<li class="foot-li"><a href="/about">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="/jobs">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.JOBS"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="//blog.flickr.net/en">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.BLOG"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="//mobile.yahoo.com/flickr">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.MOBILE"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="/services/developer">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.DEVELOPERS"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="/help/guidelines">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.GUIDELINES"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="//yahoo.uservoice.com/forums/211185-us-flickr">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.FEEDBACK"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="/abuse">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.REPORT_ABUSE"},data:i}))+'</a></li>\n				<li class="foot-li"><a href="/help/forum">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.HELP_FORUM"},data:i}))+'</a></li>\n\n				<li class="foot-li lang-switcher">\n					<a href="/change_language.gne?lang='+f(l((s=t!=null?t.selectedLang:t)!=null?s.code:s,t))+"&csrf="+f(l((s=t!=null?t.selectedLang:t)!=null?s.csrf:s,t))+'">'+f(l((s=t!=null?t.selectedLang:t)!=null?s.name:s,t))+'</a>\n					<span class="arrow"></span>\n				</li>\n			</ul>\n		</div>\n		<div class="foot-bottom-row">\n			<div class="foot-yahoo">\n				<ul class="foot-nav-ul">\n					<li class="foot-li"><a href="//info.yahoo.com/privacy/us/yahoo/flickr/details.html">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.PRIVACY"},data:i}))+'</a></li>\n					<li class="foot-li"><a href="/help/terms">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.TERMS"},data:i}))+'</a></li>\n					<li class="foot-li"><a href="//safely.yahoo.com">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.YAHOO_SAFELY"},data:i}))+'</a></li>\n					<li class="foot-li"><a href="//help.yahoo.com/kb/index?page=product&locale='+f((o=(o=n.helpLocaleKey||(t!=null?t.helpLocaleKey:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"helpLocaleKey",hash:{},data:i}):o))+'&y=PROD_FLICKR_DESK&actp=productlink">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.HELP"},data:i}))+'</a></li>\n				</ul>\n			</div>\n\n			<div class="foot-company">\n				'+f((n.intlHTMLMessage||t&&t.intlHTMLMessage||a).call(u,{name:"intlHTMLMessage",hash:{intlName:"common.A_YAHOO_COMPANY_WITH_LINK"},data:i}))+'\n			</div>\n\n			<div class="foot-social">\n				<ul class="foot-nav-ul">\n					<li><a target="_blank" href="http://flickr.tumblr.com/">\n						<svg class="ft-icon ft-tumblr"><use xlink:href="#icon-tumblr"></use></svg>\n					</a></li>\n					<li><a target="_blank" href="https://www.facebook.com/flickr">\n						<svg class="ft-icon ft-facebook"><use xlink:href="#icon-facebook"></use></svg>\n					</a></li>\n					<li><a target="_blank" href="https://twitter.com/flickr">\n						<svg class="ft-icon ft-twitter"><use xlink:href="#icon-twitter"></use></svg>\n					</a></li>\n					<li><a target="_blank" href="https://plus.google.com/+flickr">\n						<svg class="ft-icon ft-googleplus"><use xlink:href="#icon-google"></use></svg>\n					</a></li>\n				</ul>\n			</div>\n		</div>\n	</div>\n</div>\n\n'+((s=(n.isFlipped||t&&t.isFlipped||a).call(u,"enable-darla-beacon",{name:"isFlipped",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")},usePartial:!0,useData:!0}),r={};e.Array.each(["darla-script-setup"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/footer-full",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-darla-script-setup"]});
YUI.add("dropdown",function(e){"use strict";var t,n;t={css:{closed:"ui-dropdown-closed",shim:"ui-dropdown-shim",label:'span[data-action="toggle"]',items:"[data-value]",itemSelected:"ui-dropdown-item-selected",hasDialogArrow:"ui-dropdown-has-dialog-arrow",dialogArrow:"ui-dialog-arrow",useCheckMarks:"ui-dropdown-use-checkboxes"},options:{hasDialogArrow:!1,useCheckMarks:!1}},e.namespace("Views").Dropdown=n=e.Base.create("Dropdown",e.FlickrView,[],{initializer:function(e){if(e.activate===!1)return;this.activate()},activate:function(){var n=this,r=this.get("container"),i;this.close(),this._items={},e.Lang.isArray(this.get("selected"))||this.set("selected",[this.get("selected")]),r.all(t.css.items).each(function(e){var t=e.getData();n._items[t.value]={text:t.text||'no data-text for "'+t.value+'"',sub:t.sub,node:e}}),this.labelEl=r.one(t.css.label),this.labelEl||(this.labelEl=e.Node.create('<span class="truncate" data-action="toggle" />'),r.insert(this.labelEl,0)),i=this.get("staticLabel")||this.get("defaultLabel"),i&&(i===!0?this.labelEl.set("text","set staticLabel/defaultLabel to a string, not `true`"):this.labelEl.set("text",i)),this.get("hasDialogArrow")&&!r.hasClass(t.css.hasDialogArrow)&&r.addClass(t.css.hasDialogArrow),r.hasClass(t.css.hasDialogArrow)&&(this.dialogArrowEl=r.one(t.css.dialogArrow),this.dialogArrowEl||(this.dialogArrowEl=e.Node.create('<span class="ui-dialog-arrow" />'),r.insert(this.dialogArrowEl,1))),this.get("useCheckMarks")&&!r.hasClass(t.css.useCheckMarks)&&r.addClass(t.css.useCheckMarks),this.select();if(this.get("disabled"))return this.disable();this.attachEvents({":toggle":this.toggle.bind(this),":set":function(t,r){t.halt();if(!n.get("multiSelect")&&!n.get("multiSelectSub")&&e.Array.indexOf(n.get("selected"),r.value)>=0)return n.close();n.select(r.value,r)}})},select:function(n,r,i){var s=this,o=n?this._items[n]:null,u=!0,a=[],f;o&&e.Array.indexOf(this.get("selected"),n)>=0&&(this.get("multiSelect")||this.get("multiSelectSub"))?(a=this.get("selected"),!o.sub&&this.get("multiSelect")&&a.length>this.get("minimumSelected")?(a.splice(e.Array.indexOf(this.get("selected"),n),1),u=!1):o.sub&&(a.splice(e.Array.indexOf(this.get("selected"),n),1),u=!1),this.set("selected",a)):o&&(o.sub?(a.push(n),this.get("selectParent")&&a.push(o.sub),e.Array.each(this.get("selected"),function(e){s._items[e].sub===o.sub?a.push(e):s.get("multiSelect")&&!s._items[e].sub&&a.push(e)})):this.get("multiSelect")?(a=this.get("selected"),a.push(n)):a.push(n),this.set("selected",a)),i||this.close(),f={clicked:o?{text:o.text,value:n,sub:o.sub,itemEl:o.node,isChecked:u}:null,data:r,selections:a},this.fire("selected",f),this.update(n,f,t)},update:function(t,n,r){var i=this,s=n.clicked,o=this.get("selected"),u=this.get("defaultLabel")||"[Unable to select a default item]";this.get("staticLabel")||(this.get("labelFunction")?u=this.get("labelFunction").apply(this,[t]):s?n.data&&n.data.text&&n.data.text!==s.text?u=n.data.text:u=s.text:o.length>0&&i._items[o[0]]&&(u=i._items[o[0]].text),this.labelEl.set("textContent",u||"[!empty data-text!]")),this.get("container").all(r.css.items).removeClass(r.css.itemSelected),e.Array.each(o,function(e){i._items[e]&&i._items[e].node.addClass(r.css.itemSelected)})},toggle:function(e){e&&e.halt(),this._open?this.close(e):this.open(e)},open:function(e){var n=this.get("container"),r=0,i=0,s=30;this._open=!0,this.get("shouldCreateShim")&&this._shimUp(),n.removeClass(t.css.closed),this.get("autoSizeMenu")&&(r=parseInt(this.labelEl.getComputedStyle("width"),10),i=parseInt(n.one("ul").getComputedStyle("width"),10),r+s>i&&n.one("ul").setStyles({width:r+s})),(!e||!e.silent)&&this.fire("open",e)},close:function(e){e&&e.halt(),this._open=!1,this._shimUp(!1),this.fire("close",e),this.get("container").addClass(t.css.closed)},_shimUp:function(n){if(n===!1){if(!this._shim)return;this._shim.detach("click").remove(),this._shim=null;return}this._shim=e.Node.create("<div />"),this._shim.addClass(t.css.shim),this._shim.on("click",this.close.bind(this)),this.get("container").appendChild(this._shim)},disable:function(){var e=this.get("container");this.set("disabled",!0),this.close(),e.addClass(t.css.disabled),e.detach()},destructor:function(){this._shimUp(!1),this._items=null,this.labelEl=null,this.set("selected",null),this.detachAll()}},{ATTRS:{selected:{value:[]},disabled:{value:!1},hasDialogArrow:{value:!1},useCheckMarks:{value:!1},multiSelect:{value:!1},multiSelectSub:{value:!1},selectParent:{value:!0},minimumSelected:{value:0},staticLabel:{value:!1},defaultLabel:{value:!1},labelFunction:function(){},shouldCreateShim:{value:!0},autoSizeMenu:{value:!0}}})},"@VERSION@",{requires:["flickr-view","flickrui-css"]});
YUI.add("footer-full-view",function(e){var t=["en-US","zh-HK","de-DE","es-US","fr-FR","ko-KR","it-IT","pt-BR","vn-VN","id-ID"],n={"en-US":"English","de-DE":"Deutsch","es-US":"Espa\u00f1ol","fr-FR":"Fran\u00e7ais","ko-KR":"\ud55c\uae00","it-IT":"Italiano","pt-BR":"Portugu\u00eas","vn-VN":"Ti\u1ebfng Vi\u1ec7t","id-ID":"Bahasa Indonesia","zh-HK":"\u7e41\u9ad4\u4e2d\u6587"};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.get("container").get("innerHTML")===""&&this.setContainerHTML('<div class="footer-full-content"></div>'),this.appStateParams=e,this.set("hideOptOutBanner",e.hideOptOutBanner),this.set("showOptOutBanner",e.showOptOutBanner),this.set("hideMobileBanner",e.hideMobileBanner),this},subviewConfig:{},loadState:function(){var r,i,s;s=this.appContext.auth&&this.appContext.auth.csrf?this.appContext.auth.csrf:"",this.lang=this.appContext.lang,this.menuLangs=[],this.lang==="zh-Hant-HK"&&(this.lang="zh-HK"),this.lang.toLowerCase()==="vi-vn"&&(this.lang="vn-VN"),this.selectedLang={code:this.lang,name:n[this.lang],csrf:s};for(r=0,i=t.length;r<i;r++){if(t[r]===this.lang)continue;typeof t[r]=="string"&&this.menuLangs.push({code:t[r].toLowerCase(),name:n[t[r]],csrf:s})}return e.Promise.resolve()},buildContainer:function(){var t={},n={};return this.get("viewer")&&(t=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),n={displayLangs:this.displayLangs,selectedLang:this.selectedLang,helpLocaleKey:this.selectedLang.code.replace("-","_")||"en_US",menuLangs:this.menuLangs},YUI.Env.isServer?n.pageUrl=this.appContext.request.url:n.pageUrl=window.location.pathname,this.appContext.getCookie("mobile_allow_www")&&!this.appStateParams.hideMobileBanner?n.isOptedOutOfMobile=!this.get("hideMobileBanner"):!this.appContext.getCookie("mobile_allow_www")&&this.get("hideMobileBanner")&&(n.hasNoOptOut=!0),this.setContainerWithTemplate("footer-full",n),this},activate:function(){var t=this.get("container"),n=t.one(".lang-switcher"),r=n.one("a"),i=t.one(".foot-mobile-banner a"),s=t.one(".opt-out-www");return this.menuLangsFormatted=this.menuLangs.map(function(e){return{href:"/change_language.gne?lang="+e.code+"&csrf="+e.csrf,text:e.name}}),this.registerEventHandler(n.on("click",function(t){t.preventDefault(),r.addClass("dimmed");var i=new e.Views.FluidDroparound({anchorOffsetHorizontal:15,appContext:this.appContext,showDropArrow:!0,observePageResize:!0,dismissOnOverlayClick:!0,anchorElement:n.one(".arrow"),classList:["lang-droparound"],menuItems:this.menuLangsFormatted});i.show(),this.registerEventHandler(i.on("closeDroparound",function(e){r.removeClass("dimmed")}),this)},this)),i&&this.registerEventHandler(i.on("click",function(e){this.appContext.removeCookie({cookieName:"mobile_allow_www",path:"/"})},this)),s&&this.registerEventHandler(s.on("click",function(e){this.appContext.setCookie({cookieName:"mobile_allow_www",path:"/",cookieValue:1})},this)),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-footer-full","footer-full-css","url-helper","flickrui-css","flickrui-dialogs-css","dropdown","fluid-droparound-view"],langBundles:["common"]});
YUI.add("photolist-aft-helper",function(e){"use strict";var t=function(e){e=e.getDOMNode();var t=e.getBoundingClientRect();return t.top>=window.pageYOffset&&t.left>=window.pageXOffset};e.PhotolistAftHelper=function(e,t){var n=e.onSubviewEvent;this.appContext=e.appContext,this.viewName=e.name,this.container=e.get("container"),t&&(this.hasRequiredSubviews=!0,this.paftResults={},t.forEach(function(e){this.paftResults[e]={}}.bind(this))),YUI.Env.isServer||this.appContext.clientMetrics.setPendingMeasurement(e.name,!0),e.onSubviewEvent=function(t,r){(r&&r[0]==="atfVisible"||r[0]==="atfActivated")&&this.aftHelper.handleAFTResult(t,r),n&&n.call(e,t,r)}},e.PhotolistAftHelper.prototype.handleAFTResult=function(e,n){var r=n[0];if(this.hasRequiredSubviews){if(n.length>2&&this.container){var i=this.container.one("."+n[2]);if(i&&!t(i)){delete this.paftResults[n[2]],this.beaconIfAllAFTResultsComplete(r);return}}e=n[2]}this.paftResults||(this.paftResults={},this.hasRequiredSubviews||(this.paftResults[e]={})),this.paftResults[e][r]=n[1]||(new Date).getTime(),this.beaconIfAllAFTResultsComplete(r)},e.PhotolistAftHelper.prototype.beaconIfAllAFTResultsComplete=function(t){var n=0,r;if(this.allResultsReceived)return;this.allResultsReceived=Object.keys(this.paftResults).every(function(e){return r=this.paftResults[e][t],typeof r=="undefined"?!1:(r>n&&(n=r),!0)}.bind(this)),this.allResultsReceived&&t==="atfVisible"&&(this.appContext.hasClientSideRouted()?(this.appContext.clientMetrics.mark("AFT_CL",n),this.appContext.clientMetrics.mark("AFT",n)):(e.config.win.performance&&e.config.win.performance.timing&&(n-=e.config.win.performance.timing.navigationStart),this.appContext.clientMetrics.record("AFT_SV",n),this.appContext.clientMetrics.record("AFT",n)),this.appContext.clientMetrics.setPendingMeasurement(this.viewName,!1),this.appContext.clientMetrics.beacon())}},"@VERSION@",{affinity:"",requires:["flickr-promise","event-custom"]});
YUI.add("album-page-view",function(e,t){var n=require("lib/flog")(t),r=190,i=430,s=null,o=3;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.albumId=t.albumId,this.isOwner=t.isOwner,this.isTwitterbot=t.isTwitterbot,this.albumPhotoListLayoutStyle=t.albumPhotoListLayoutStyle,t.id=t.albumId,t.modelRegistryName="set-models",t.maxNumAttrName="totalCount",this.pageParams=t.pageParams,t.photoListConfig={modelParams:{registryName:"set-models",modelIdOrAttributes:t.albumId,collectionAttributeName:"photoPageList"},parentName:this.name,pageParams:t.pageParams,contextSuffix:"album-"+t.albumId,measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:t.withPhotoId},t.photoListConfig.layout={targetRowHeight:this.albumPhotoListLayoutStyle==="justified"?r:i,fullWidthBreakoutRowCadence:this.albumPhotoListLayoutStyle==="justified"?s:o,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:4,right:0,bottom:4,left:0},itemSpacing:{horizontal:4,vertical:4}},this.aftHelper=new e.PhotolistAftHelper(this),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"album-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,disabled:function(){return this.pageParams.viewPageSize?!1:!0}},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(e){return e.isMobile||!this.appContext.flipper.isFlipped("enable-mini-sign-up-footer")||this.appContext.getViewer().signedIn||this.appContext.lang!=="en-US"}},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("set-models",this.albumId).then(function(t){e.set("albumModel",t)})},buildContainer:function(){return this.setContainerWithTemplate("album-page"),this},buildHeadContainer:function(){var t=this.get("albumModel"),r=t.getValue("photoPageList").getList(),i="summary",s=[],o,u=(this.pageParams.nominalPage-1)*this.pageParams.viewPageSizeForShare||0,a,f;if(this.isTwitterbot&&r.length-u>=4){i="gallery";for(f=0;f<Math.min(r.length-u,4);f++)if(r[u+f]){var l=r[u+f].getSizeToFit({width:640,height:640});l&&l.url&&s.push({property:"twitter:image"+f,content:l.url})}else n.error("Missing album photo in album list",{index:u+f})}t.registry?o=t.registry.getSizeToFit(this.albumId,{width:640,height:640}):n.error("Missing album model registry"),a=this.templates("dynamic-page-head")({title:t.getValue("title"),description:t.getValue("description"),url:t.getValue("url"),fullURL:e.url(t.getValue("url")),openGraphImageURL:o?e.URLHelper.addProtocolToURL(o.url):"",openGraphaImageWidth:o?o.width:"",openGraphaImageHeight:o?o.height:"",ownerURL:t.getValue("owner").getValue("url"),twitterCardType:i,twitterImages:s,flickrType:"set",domain:e.url()}),a+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),a+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, initial-scale=1, maximum-scale=1"}),a+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",a):(this.set("headContainer",a.concat(this.subviews["pagination-view"].get("headContainer"))),this.updateHead())},activate:function(){var t=this,n=this.get("albumModel"),u=n.getValue("isOwner");return e.later(100,this,function(){e.use("photo-page-scrappy-view")}),e.on("albumToolbarView:layoutChange",function(e){var n=t.subviews["photo-list-view"],u=n.photoListLayout;u.targetRowHeight=e==="justified"?r:i,u.fullWidthBreakoutRowCadence=e==="justified"?s:o,n.setItems(t.get("albumModel").getValue("photoPageList").getList())}),u||this.appContext.getViewCounter().recordAlbumView({albumOwnerID:n.getValue("owner").getValue("id"),albumID:n.getValue("id"),referrer:this.appContext.getReferrer()}),this},onSubviewEvent:function(e,t){t&&t[0]==="newPhotoAddedToAlbum"&&this.subviews["photo-list-view"].setItems(this.get("albumModel").getValue("photoPageList").getList())},getTrackingSegments:function(){return{vwrOwner:this.isOwner?1:0}}},{ATTRS:{spaceid:{value:792600538}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","set-models","hermes-template-album-page","hermes-template-dynamic-page-head","hermes-template-head-meta","hermes-template-head-link","album-page-css","album-toolbar-view","album-header-view","photo-list-view","footer-full-view","photolist-aft-helper","url-helper"],langBundles:["album-page"]});
YUI.add("album-privacy-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)}},attributes:{totalCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},hasPhotosPrivate:{readOnly:!0,derivedBy:["totalCount","countPhotosPublic"],defaultFn:function(e){return this.getValue(e,"totalCount")-this.getValue(e,"countPhotosPublic")}},countPhotosFamily:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},countPhotosFriend:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},countPhotosFriendFamily:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},countPhotosPublic:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-getPhotos-fetcher"]});
YUI.add("hermes-lang-client-app",function(e,t){e.Intl.add("hermes/client-app","en-US",{SAVING_LAST_ACTIONS:["Hey! We\u2019re still saving your last actions, you might lose them if you leave this page."],UPLOAD_IN_PROGRESS:["Wait! Your photos are still on the way to our servers. They might not get there if you leave this page before they arrive."]})},"@VERSION@",{requires:["intl"]});
