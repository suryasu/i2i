<!DOCTYPE html>
<html lang="en">
  <head>
    <title>i2i | View Requests</title>
 
    
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
 
    <link href="http://getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">
    <link href="../static/signup.css" rel="stylesheet">
    <script src="../static/js/jquery-1.12.3.min.js"></script>
    
  </head>
 
<style>
body {
    background-image: url("http://www.atpilgrimage.com/wp-content/uploads/2015/02/team-building-corporate-singapore-1024x862.jpg");
    background-repeat: no-repeat;
    background-size: cover;
   -moz-background-size: cover;
   -o-background-size: cover;
   -webkit-background-size: cover;
}
</style>
<script>
        $(function(){
            // Store project Id to be used as query string
                $.ajax({
                    url: '/getIncomRequests',
                    type: 'GET',
                    success:function(response) {
                    // console.log(response);
                    var data = JSON.parse(response);

                    for (var i = 0; i <data.length; i++) {
                        var _request_id = data[i]["ID"];
                        var _sender_id = data[i]["RequesterID"];
                        var _project_title = data[i]["ProjectTitle"];
                        displayIncomingRequests(_sender_id, _project_title, _request_id);
        
                    }
                    getSentRequests();
                    
                },
                error:function(error){
                    console.log(error);
                }
            });
        })
        function displayIncomingRequests(user_id, _project_title, _request_id) {
            $.ajax({
                url:'/getUserNameById/' + user_id,
                type: 'GET',
                success: function(response) {
                            //
                    var data2  = JSON.parse(response);
                    userName = data2[0][0];
        
                    var incomdiv = $('<div>').attr('class','da-slider');
                    var reqdiv = $('<div>').attr('class', 'da-slider');
                    reqdiv.append(
                            "<div class = da-slide>"

                                +"<p>"
                                    + userName
                                    + " requests to join your project: "
                                    + _project_title
                                +"</p>"
       
                        );
                    reqdiv.append("<button type='button' onclick=acceptReq(" + _request_id + ")>Accept</button>");
                    reqdiv.append("<button type='button' onclick=declineReq(" + _request_id + ")>Decline</button>");
                    reqdiv.append(+"</div>");
                    incomdiv.append(reqdiv);
                    $('#incomWell').append(incomdiv);

                    
                }
        
            });
        }

        function displaySentRequests(user_id, _project_title, _request_id) {
            $.ajax({
                url:'/getUserNameById/' + user_id,
                type: 'GET',
                success: function(response) {
                            //
                    var data2  = JSON.parse(response);
                    userName = data2[0][0];
        
                    var sentdiv = $('<div>').attr('class','da-slider');
                    var reqdiv = $('<div>').attr('class', 'da-slider');
                    reqdiv.append(
                            "<div class = da-slide>"

                                +"<p>"
                                    + "You requested to join "
                                    + userName
                                    + "'s project: "
                                    + _project_title
                                // +"</p>"
       
                        );
                    reqdiv.append("<button type='button' onclick=cancelReq(" + _request_id + ")>Cancel request</button></p>");

                    reqdiv.append(+"</div>");
                    sentdiv.append(reqdiv);
                    $('#sentWell').append(sentdiv);

                    
                }
        
            });
        }

        function getSentRequests() {
            // body...
            $.ajax({
                url: '/getSentRequests',
                type: 'GET',
                success:function(response) {
                    // console.log(response);
                    var data = JSON.parse(response);

                    for (var i = 0; i <data.length; i++) {
                        var _request_id = data[i]["ID"];
                        // console.log(_request_id);
                        var _owner_id = data[i]["OwnerID"];
                        var _project_title = data[i]["ProjectTitle"];
                        displaySentRequests(_owner_id, _project_title, _request_id);

            
                    }
                    
                },
                error:function(error){
                    console.log(error);
                }
            });
        }

        function cancelReq(_request_id) {
            console.log("Canceled request: ", _request_id);
            $.ajax({
                url: '/deleteRequest/' + _request_id,
                type: 'POST',
                success:function(response) {
                    console.log(response);
                    
                },
                error:function(error){
                    console.log(error);
                }
            });
        }

        function acceptReq(_request_id) {
            
            console.log("Accept request: ", _request_id);
        }

        function declineReq(_request_id) {
            console.log("Declined request: ", _request_id);
            $.ajax({
                url: '/deleteRequest/' + _request_id,
                type: 'POST',
                success:function(response) {
                    console.log("hi")
                    console.log(response);
                    
                },
                error:function(error){
                    console.log(error);
                }
            });
            
        }

    </script>
 
    <div class="container">
      <div class="header">
        <nav>
          <ul class="nav nav-pills pull-right">
            <li role="presentation" ><a href="/">Home</a></li>
            <li role="presentation"><a href="/userHome">User Home</a></li>
            <li role="presentation"><a href="/logout">Logout</a></li>
          </ul>
        </nav>
        <h3 class="text-muted">I2I</h3>
      </div>
 

      <div class="row marketing">
            <div class="col-lg-6">
            <h2><center>My Requests</center></h2>
            <h3>Incoming Requests</h3>
            <div class="well" id="incomWell">

            </div>

            <h3>Sent Requests</h3>
            <div class="well" id="sentWell">

            </div>

            </div>
 
        </div>

 
       
 
      <footer class="footer">
        <p>&copy; i2i 2016</p>
      </footer>
 
    </div>
  </body>
</html>